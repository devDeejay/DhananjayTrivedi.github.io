(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/comments/comment_dom",["external/react","modules/clean/referrer_cleansing_redirect"],function(t,n){var i,r,o;return i="…",r=function(i,r,s){var a,c,l,u,h,d,p,_,m,f,g,v,y,w,I,E,T,b;for(null==r&&(r=!0),null==s&&(s=null),c=t.DOM,p=/@\[(?:\s*(?:dbid:)?[^:\[\]]+):(?:[^\[]+)\]/i,d=/@\[(\s*(?:dbid:)?[^:\[\]]+):([^\[]+)\]/i,b="(?:[-a-zA-Z0-9@:%_+~#=]+[.])+[a-z]{2,6}(?:[:./?#][-a-zA-Z0-9@%_+~&=]+)*(?=[^a-zA-Z0-9_]|$)",E="http://"+b+"|https://"+b+"|www."+b+"|"+b,T=new RegExp(E,"i"),h=/\n/,v=[p,h],r&&v.push(T),y=RegExp("("+function(){var e,t,n;for(n=[],e=0,t=v.length;t>e;e++)f=v[e],n.push(f.source);return n}().join("|")+")","gi"),m=[],g=i.split(y),l=0,u=g.length;u>l;l++)a=g[l],a&&(a.match(p)?(w=a.match(d),_=w[2].trim(),m.push(c.span({className:"comment-mention"},_))):e.call(v,T)>=0&&a.match(T)?(I=a,I.indexOf("http://")<0&&I.indexOf("https://")<0&&(I="http://"+I),I=n.get_redirect_uri(I),m.push(c.a({href:I,target:"_blank",rel:"noopener noreferrer"},a))):a.match(h)?m.push(c.br({})):m.push(a));return o(m,s)},o=function(e,t){var n,r,o,s,a,c,l,u,h;if(null==t&&(t=null),!t)return e;if(n=0,h=[],0>=t)return e.length>0?i:e;for(r=0,s=e.length;s>r;r++)if(u=e[r],"object"==typeof u){if(null!=(null!=(a=u.props)?a.children:void 0)&&(n+=null!=(c=u.props)&&null!=(l=c.children)?l.length:void 0),h.push(u),n>=t)return h.push(i),h}else{if(n+u.length>=t)return o=t-n,h.push(u.substring(0,o)),h.push(i),h;n+=u.length,h.push(u)}return e},{convertRawCommentTextToReactDom:r}})}).call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/growth/experiments/onboarding_server_view",["jquery","modules/clean/web_timing_logger"],function(t,n){var i;return new(i=function(){function i(){this.move_forward=e(this.move_forward,this);var i;this.active_page_index=0,t("#onboarding-page-"+this.active_page_index).show(),n.mark_time_to_interactive(),t(".move-forward").on("click",this.move_forward),i=function(){return t(".onboarding-page").fadeOut(500,function(){return window.close()})},t(".close-window-button").on("click",i)}return i.prototype.move_forward=function(){var e,n,i;return t("#onboarding-page-"+this.active_page_index).hide(),this.active_page_index+=1,e=t("#onboarding-page-"+this.active_page_index),i=e.find(".next-button"),i.hide(),i.fadeIn(500),n=e.find(".onboarding-page-image"),e.show()},i}())})}.call(this),function(){define("modules/clean/react/file_icon_view",["external/underscore","external/classnames","external/react","modules/clean/react/helpers","modules/clean/react/sprite"],function(e,t,n,i,r){var o,s,a,c;return a=i.compareStateAndProps,c=n.DOM,s=n.PropTypes,o=n.createClass({displayName:"FileIconView",propTypes:{className:s.string,icon:s.string.isRequired,src:s.string},getInitialState:function(){return{useIcon:!1}},shouldComponentUpdate:a,_onError:function(){return this.setState({useIcon:!0})},render:function(){var e,i;return e=[this.props.className,"file-icon"],this.state.useIcon||!this.props.src?(i=n.createElement(r,{ref:"img",group:"web",name:this.props.icon,alt:"",className:"file-icon__img"}),e.push("file-icon--sprite")):(i=c.img({ref:"img",src:this.props.src,onError:this._onError,className:"file-icon__img"}),e.push("file-icon--thumbnail")),c.span({className:t.apply(null,e)},i)}})})}.call(this),function(){var e=[].slice;define("modules/clean/react/file_path_breadcrumb",["jquery","external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/browse_interface","modules/clean/em_string","modules/clean/viewer"],function(t,n,i,r,o,s,a,c){var l,u,h,d,p,_;return h=o._,d=r.DOM,u=100,_=function(e){return Math.floor(1e3*e)},p=function(e){return e/1e3},l=r.createClass({displayName:"FilePathBreadcrumb",propTypes:{paths:r.PropTypes.arrayOf(r.PropTypes.shape({name:r.PropTypes.string.isRequired,url:r.PropTypes.string.isRequired})).isRequired,pathClassname:r.PropTypes.string,handlePathClick:r.PropTypes.func,maxWidth:r.PropTypes.number,minPathWidth:r.PropTypes.number,morePathsString:r.PropTypes.string,pathDividerWidth:r.PropTypes.number,viewingUserId:r.PropTypes.number.isRequired,useLinks:r.PropTypes.bool},getDefaultProps:function(){return{pathClassname:"recents-item__subheading-path",maxWidth:46,minPathWidth:3,morePathsString:"…",pathDividerWidth:1.077,handlePathClick:n.noop,useLinks:!0}},_handlePathClick:function(){return this.props.handlePathClick()},_getTotalPathWidth:function(e){var t,n,i,r,o,s;for(s=0,o=_(this.props.pathDividerWidth),t=n=0,i=e.length;i>n;t=++n)r=e[t],s+=r.workingWidth,t<e.length-1&&(s+=o);return s},_createPathMetadata:function(e){var t;return t=new a(e.name).length,{name:e.name,href:e.url,width:t,workingWidth:_(t)}},_getPathsAvailable:function(){return this.props.paths.length>1?this.props.paths.slice(1):this.props.paths},_getPathsToShow:function(){var e,t,i,r,o,s,a,l,h,d,m,f,g,v,y,w,I,E,T,b,C,S,R;for(f=_(this.props.minPathWidth),y=_(this.props.pathDividerWidth),e=_(this.props.maxWidth),R=c.get_viewer(),S=R.get_user_by_id(this.props.viewingUserId),E=[],I=this._getPathsAvailable(),r=s=0,m=I.length;m>s;r=++s)v=I[r],w=this._createPathMetadata(v),E.push(w);for(C=function(){var t;return t=n.last(E),t.width=p(e),t.workingWidth=e,[t]},g=1,o=0;this._getTotalPathWidth(E)>e;){if(o++>u)return C();if(g+1<E.length)t=E[0],b=this._createPathMetadata({name:this.props.morePathsString}),i=[t,b],d=E.slice(g+1,E.length),E=i.concat(d),g++;else{if(1===E.length)return C();for(h=e,r=a=0,T=E.length-1;T>=0?T>a:a>T;r=T>=0?++a:--a)v=E[r],h-=v.workingWidth+y;if(f>h)return C();l=n.last(E),l.width=p(h),l.workingWidth=h}}return E},_renderPaths:function(){var t,n;return t=this._handlePathClick,n=this._getPathsToShow().map(function(e){return function(n){var r,o;return o=a.em_snippet(n.name,n.width),r=[e.props.pathClassname],n.href&&e.props.useLinks?d.a({href:n.href,className:i.apply(null,r),onClick:t},o):(r.push(e.props.pathClassname+"--more"),d.span({className:i.apply(null,r)},o))}}(this)),d.span.apply(d,[null].concat(e.call(n)))},render:function(){return this._renderPaths()}})})}.call(this);var __assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};define("modules/clean/react/sticky/container",["require","exports","external/react","external/react-dom","modules/clean/react/sticky/utils","modules/clean/raf"],function(e,t,n,i,r,o){"use strict";var s=o.requestAnimationFrame,a=o.cancelAnimationFrame,c=n.addons.PureRenderMixin,l=n.createClass({displayName:"NativeStickyContainer",mixins:[c],propTypes:{offsetTop:n.PropTypes.number},render:function(){var e=this,t=n.Children.map(this.props.children,function(t){return n.cloneElement(t,{nativeSupport:!0,containerOffsetTop:e.props.offsetTop,hasParent:!0})});return n.createElement("div",{className:"native-sticky-container"},t)}}),u=n.createClass({displayName:"ShimStickyContainer",mixins:[c],propTypes:{offsetTop:n.PropTypes.number},getDefaultProps:function(){return{offsetTop:0}},getInitialState:function(){return{top:0,bottom:0}},changeEvents:["resize","scroll","touchstart","touchmove","touchend"],_currentAnimationRequestId:null,_ticking:!1,componentDidMount:function(){var e=this;this.changeEvents.forEach(function(t){window.addEventListener(t,e._requestTick)}),this._requestTick()},componentWillUnmount:function(){var e=this;a(this._currentAnimationRequestId),this.changeEvents.forEach(function(t){window.removeEventListener(t,e._requestTick)})},_requestTick:function(){var e=this;this._ticking||(this._ticking=!0,this._currentAnimationRequestId=s(function(){e._updateMeasurements(),e._ticking=!1}))},_updateMeasurements:function(){var e=i.findDOMNode(this).getBoundingClientRect(),t=e.top,n=e.bottom;this.setState({top:t,bottom:n})},render:function(){var e=this,t=n.Children.map(this.props.children,function(t){return n.cloneElement(t,{nativeSupport:!1,containerTop:e.state.top,containerBottom:e.state.bottom,containerOffsetTop:e.props.offsetTop,hasParent:!0})}),i={position:"relative"};return n.createElement("div",{style:i,className:"shim-sticky-container"},t)}});t.StickyContainer=n.createClass({displayName:"StickyContainer",mixins:[c],propTypes:{offsetTop:n.PropTypes.number},getDefaultProps:function(){return{offsetTop:0}},getInitialState:function(){return{featureEnabled:!1,nativeSupport:!1}},componentDidMount:function(){this.setState({featureEnabled:!0,nativeSupport:r.isCssDeclarationSupported("position","sticky")})},render:function(){return this.state.featureEnabled?this.state.nativeSupport?n.createElement(l,__assign({},this.props)):n.createElement(u,__assign({},this.props)):n.createElement("div",__assign({},this.props,{className:"sticky-container__placeholder"}))}})});var __assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};define("modules/clean/react/sticky/sticky",["require","exports","external/react","external/react-dom","external/classnames","modules/clean/react/sticky/utils"],function(e,t,n,i,r,o){"use strict";var s=n.addons.PureRenderMixin,a=n.createClass({displayName:"NativeSticky",mixins:[s],propTypes:{containerOffsetTop:n.PropTypes.number},getDefaultProps:function(){return{containerOffsetTop:0}},render:function(){var e=o.getPrefixedCssPropertyValue("position","sticky"),t={top:this.props.containerOffsetTop,position:e};return n.createElement("div",{style:t,className:"native-sticky"},this.props.children)}}),c=n.createClass({displayName:"ShimSticky",propTypes:{containerTop:n.PropTypes.number,containerBottom:n.PropTypes.number,containerOffsetTop:n.PropTypes.number,offsetHeight:n.PropTypes.number,slideDownDuration:n.PropTypes.number},getInitialState:function(){return{translateY:0,transitionDuration:0}},getDefaultProps:function(){return{containerTop:0,containerBottom:0,containerOffsetTop:0,offsetHeight:0,slideDownDuration:300}},componentDidMount:function(){var e=i.findDOMNode(this).getBoundingClientRect().top,t=this.props.containerOffsetTop-e,n=this.props.offsetHeight,r=this.props.slideDownDuration,o=n>t?-t:-n;t>0&&this._performSlideDownAnimation(o,r)},_performSlideDownAnimation:function(e,t){var n=this;this.setState({translateY:e,transitionDuration:0}),setTimeout(function(){n.setState({translateY:0,transitionDuration:t})},0)},shouldComponentUpdate:function(e,t){var n=this.props.containerOffsetTop,i=this.props.containerTop,r=this.props.containerBottom,o=this.props.offsetHeight,s=this.state.translateY,a=this.state.transitionDuration,c=e.containerOffsetTop,l=e.containerTop,u=e.containerBottom,h=e.offsetHeight,d=t.translateY,p=t.transitionDuration,_=n>=i,m=c>=l,f=n>=r-o,g=c>=u-h;return s!==d||a!==p||o!==h||n!==c||_!==m||f!==g},render:function(){var e=this.props.containerOffsetTop,t=this.props.containerTop,i=this.props.containerBottom,o=this.props.offsetHeight,s=e>=t,a=e>=i-o,c=this.state.translateY,l=this.state.transitionDuration,u={},h={},d=["shim-sticky"];return s&&(u={height:o},a?(h={position:"absolute",bottom:0},d.push("shim-sticky--stuck")):(h={position:"fixed",top:e,transitionProperty:"transform",transitionDuration:l+"ms",transform:"translateY("+c+"px)"},d.push("shim-sticky--fixed"))),n.createElement("div",{className:r(d)},n.createElement("div",{style:u,className:"shim-sticky__stub"}),n.createElement("div",{style:h,className:"shim-sticky__sticky"},this.props.children))}});t.Sticky=n.createClass({displayName:"Sticky",mixins:[s],propTypes:{nativeSupport:n.PropTypes.bool,containerTop:n.PropTypes.number,containerBottom:n.PropTypes.number,containerOffsetTop:n.PropTypes.number,hasParent:n.PropTypes.bool},getDefaultProps:function(){return{hasParent:!1,nativeSupport:!1}},render:function(){return this.props.hasParent?this.props.nativeSupport?n.createElement(a,__assign({},this.props)):n.createElement(c,__assign({},this.props)):n.createElement("div",__assign({},this.props,{className:"sticky__placeholder"}))}})}),define("modules/clean/react/sticky/utils",["require","exports"],function(e,t){"use strict";function n(e,t){var n=e+":",i=document.createElement("test");return i.style.cssText=n+["-webkit-","-moz-","-ms-","-o-",""].join(t+";"+n)+(t+";"),i.style[e]||""}function i(e,t){return-1!==n(e,t).indexOf(t)}t.getPrefixedCssPropertyValue=n,t.isCssDeclarationSupported=i}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/recent_activity/actions/error_actions",["external/underscore","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/raf","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher"],function(t,n,i,r,o,s,a){var c,l,u;return u=i._,c=s.ActionTypes,new(l=function(){function i(t){this._flushQueues=e(this._flushQueues,this),this._dispatcher=t,this._recentActivityQueue=[],this._relatedActivityQueue=[],this._rafId=null}return i.prototype.recentActivityParseError=function(e,t){return n.reportException({err:t}),this._notify(),this._enqueueError(this._recentActivityQueue,e,t)},i.prototype.relatedActivityParseError=function(e,t){return n.reportException({err:t}),this._notify(),this._enqueueError(this._relatedActivityQueue,e,t)},i.prototype._enqueueError=function(e,t,n){return e.push({activityKey:t,error:n}),this._rafId?void 0:this._rafId=o.requestAnimationFrame(this._flushQueues.bind(this))},i.prototype._flushQueues=function(){var e,t;return this._rafId=null,e=this._recentActivityQueue,this._recentActivityQueue=[],e.length&&this._dispatcher.dispatch({type:c.RAW_RECENT_ACTIVITY_PARSE_ERROR,errors:e}),t=this._relatedActivityQueue,this._relatedActivityQueue=[],t.length?this._dispatcher.dispatch({type:c.RAW_RELATED_ACTIVITY_PARSE_ERROR,errors:t}):void 0},i.prototype._notify=t.throttle(function(){var e;return e=u("Sorry, we were unable to show some recent items. The team has been notified"),r.error(e)},500,{trailing:!1}),i}())(a)})}.call(this),function(){define("modules/clean/recent_activity/react/attachment_file_icon_view",["external/underscore","external/classnames","external/react","modules/clean/em_string","modules/clean/react/sprite","modules/clean/recent_activity/react/selectable_view"],function(e,t,n,i,r,o){var s,a,c;return c=n.DOM,a=n.PropTypes,s=n.createClass({displayName:"AttachmentFileIconView",propTypes:{id:a.string,file:a.shape({displayName:a.string.isRequired,icon:a.string.isRequired,entityUri:a.string}),overlayText:a.string,handleClick:a.func,handleContextMenu:a.func,showCheckmark:a.bool,handleToggleSelect:a.func,isSelected:a.bool},getDefaultProps:function(){return{handleClick:e.noop,handleContextMenu:e.noop}},_onClick:function(e){return e.preventDefault(),this.props.handleClick(this.props.id)},_onContextMenu:function(e){return e.preventDefault(),this.props.handleContextMenu(this.props.id)},_renderFilename:function(){var e,t,n;return n=this.props.file.displayName.split("."),t="."+n.pop(),e=i.em_snippet(n.join("."),10),c.span({ref:"filename",className:"attachment-item__filename"},e,c.wbr(),c.span({className:"nowrap"},t))},_renderIcon:function(){return n.createElement(r,{ref:"icon",alt:"",group:"web",name:this.props.file.icon,className:"attachment-item__icon"})},render:function(){var e,i,r,s,a,l,u;return l=this._renderIcon(),a=this._renderFilename(),this.props.overlayText&&(u=c.span({ref:"overlay",className:"attachment-item__overlay"},this.props.overlayText)),this.props.showCheckmark&&(r=n.createElement(o,{id:this.props.id,ref:"checkmark",handleToggleSelect:this.props.handleToggleSelect,isSelected:this.props.isSelected})),i={ref:"anchor",href:this.props.file.entityUri,title:this.props.file.displayName,className:"attachment-item__anchor",onClick:this._onClick,onContextMenu:this._onContextMenu},e=c.a(i,l,a,u,r),s={"attachment-item":!0,"attachment-item--file-thumb":!0,"attachment-item--show-more":!!this.props.overlayText,"attachment-item--selected":this.props.isSelected},c.div({className:t(s)},e)}})})}.call(this),function(){define("modules/clean/recent_activity/react/attachment_grid",function(){var e;return e=function(){function e(e,t){this._gridWidth=e,this._gutterWidth=t}return e.create=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(e,arguments,function(){})},e.prototype.generate=function(e,t){var n,i,r;for(null==t&&(t=1/0),i=[],n=0;i.length<t&&n<e.length;)r=this._buildRow(e.slice(n)),n+=r.length,i.push(r);return i},e.prototype._buildRow=function(e){var t,n,i,r,o;for(o=[],t=this._gridWidth+this._gutterWidth,n=0,r=e.length;r>n&&(i=e[n],t=t-i.width-this._gutterWidth,t>=0||0===o.length);n++)o.push(i);return o},e}()})}.call(this),function(){define("modules/clean/recent_activity/react/attachment_image_expanded_view",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/accessibility/utils","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i,r,o){var s,a,c,l,u,h;return l=i._,u=r.accessibleTriggerProps,h=n.DOM,c=n.PropTypes,a={VIDEO:"video"},s=n.createClass({displayName:"AttachmentImageExpandedView",propTypes:{id:c.string,image:c.shape({thumbnailUrl:c.string.isRequired,entityUri:c.string,displayName:c.string,width:c.number,height:c.number}),badgeType:c.oneOf(e.values(a)),handleClick:c.func,handleLoadError:c.func,showCheckmark:c.bool,handleToggleSelect:c.func,handleCornerClick:n.PropTypes.func,isSelected:c.bool},_handleCornerClick:function(e){return e.preventDefault(),this.props.handleCornerClick(this.props.id)},render:function(){var t,i;return t=h.div({className:"attachment-item--expanded__image"},n.createElement(o,this.props)),i=h.a(e.extend(u(this._handleCornerClick),{ref:"overlayCorner",className:"attachment-item--expanded__corner"}),"-"),h.div({className:"attachment-item attachment-item--expanded",style:{width:this.props.image.width,height:this.props.image.height}},t,i)}})})}.call(this),function(){define("modules/clean/recent_activity/react/attachment_image_stack_view",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i,r){var o,s,a,c,l;return c=i._,l=n.DOM,a=n.PropTypes,s={VIDEO:"video"},o=n.createClass({displayName:"AttachmentImageStackView",propTypes:{id:a.string,image:a.shape({thumbnailUrl:a.string.isRequired,entityUri:a.string,displayName:a.string,width:a.number,height:a.number}),badgeType:a.oneOf(e.values(s)),handleClick:a.func,handleLoadError:a.func,handleCornerClick:n.PropTypes.func,stackLength:n.PropTypes.number,isSelected:a.bool},_handleCornerClick:function(e){return e.preventDefault(),this.props.handleCornerClick(this.props.id)},render:function(){var t,i,o,s,a,c,u;return s=this.props.image.width,o=this.props.image.height,u=s-4,c=o-4,i=l.div({ref:"imgFront",className:"attachment-item--stacked__front"},n.createElement(r,e.extend({},this.props,{image:e.extend({},this.props.image,{width:u,height:c})}))),t=l.div({ref:"imgBack",className:"attachment-item--stacked__back"},n.createElement(r,{image:e.extend({},this.props.image,{width:u,height:c})})),a=l.a({ref:"overlayCorner",className:"attachment-item--stacked__corner",onClick:this._handleCornerClick},"+%(count)s".format({count:this.props.stackLength-1})),l.div({className:"attachment-item attachment-item--stacked",style:{width:s,height:o}},i,t,a)}})})}.call(this),function(){define("modules/clean/recent_activity/react/attachment_image_view",["external/underscore","external/classnames","external/react","modules/clean/react/helpers","modules/clean/recent_activity/react/selectable_view"],function(e,t,n,i,r){var o,s,a,c,l;return c=i.compareStateAndProps,l=n.DOM,a=n.PropTypes,s={VIDEO:"video"},o=n.createClass({displayName:"AttachmentImageView",statics:{BadgeType:s},propTypes:{id:a.string,image:a.shape({thumbnailUrl:a.string.isRequired,entityUri:a.string,displayName:a.string,width:a.number,height:a.number}),badgeType:a.oneOf(e.values(s)),overlayText:a.string,handleClick:a.func,handleContextMenu:a.func,handleLoadError:a.func,showCheckmark:a.bool,handleToggleSelect:a.func,isSelected:a.bool},getDefaultProps:function(){return{handleClick:function(){},handleContextMenu:function(){},handleLoadError:function(){},handleToggleSelect:function(){},showCheckmark:!1,isSelected:!1}},getInitialState:function(){return{isLoading:!0}},shouldComponentUpdate:c,_onClick:function(e){return e.preventDefault(),this.props.handleClick(this.props.id)},_onContextMenu:function(e){return e.preventDefault(),this.props.handleContextMenu(this.props.id)},_onLoad:function(){return this.setState({isLoading:!1})},_onError:function(){return this.props.handleLoadError(this.props.id),this.setState({isLoading:!1})},_handletoggleSelected:function(e){return e.preventDefault(),e.stopPropagation(),this.props.handleToggleSelect(this.props.id,!this.props.isSelected)},render:function(){var e,i,o,s,a,c;return a=l.img({ref:"img",alt:this.props.image.displayName,className:"attachment-item__thumbnail",src:this.props.image.thumbnailUrl,onLoad:this._onLoad,onError:this._onError}),this.props.overlayText&&(c=l.span({ref:"overlay",className:"attachment-item__overlay"},this.props.overlayText)),this.props.showCheckmark&&(o=n.createElement(r,{id:this.props.id,ref:"checkmark",handleToggleSelect:this.props.handleToggleSelect,isSelected:this.props.isSelected})),i={href:this.props.image.entityUri,onClick:this._onClick,onContextMenu:this._onContextMenu,title:this.props.image.displayName,className:"attachment-item__anchor",style:{width:this.props.image.width,height:this.props.image.height},tabIndex:0},e=l.a(i,a,c),s={"attachment-item":!0,"attachment-item--show-more":!!this.props.overlayText,"attachment-item--is-loading":this.state.isLoading,"attachment-item--selected":this.props.isSelected},s["attachment-item--badge-"+this.props.badgeType]=!!this.props.badgeType,l.div({className:t(s)},e,o)}})})}.call(this),function(){define("modules/clean/recent_activity/react/attachment_list_layout",["external/underscore","modules/core/browser","modules/core/exception","modules/clean/photos/thumbnail_url_util","modules/clean/recent_activity/react/attachment_grid","modules/clean/recent_activity/react/attachment_image_view","modules/clean/recent_activity/react/attachment_file_icon_view"],function(e,t,n,i,r,o,s){var a,c,l,u,h,d,p,_,m,f,g,v,y,w,I,E,assert;return assert=n.assert,w=i.ThumbnailSizeMode,v=w.FIT_ONE,_=w.EXACT_NO_BACKGROUND,y=100,m=100,p=200,h=200,g=75,f=359,d=718,l=92,c=100,u=3,I={AGGREGATED_SCALED:"aggregated-scaled",AGGREGATED_WIDE_CROPPED:"aggregated-wide-cropped",AGGREGATED_CROPPED:"aggregated-cropped"},E=function(n,r){var o,s,a,c;switch(s=t.is_high_density_display(),r){case I.AGGREGATED_SCALED:c=s?p:y,o=s?h:m,a=v;break;case I.AGGREGATED_CROPPED:c=s?p:y,o=s?h:m,a=_;break;case I.AGGREGATED_WIDE_CROPPED:c=s?d:f,o=s?h:m,a=_;break;default:assert(!1,"type: "+r+" must be one of: "+e.values(I))}return i.thumbnailUrlForSize(n,c,o,a)},a=function(){function t(e,t,n){this._gridWidth=e,this._columnWidth=t,this._gutterWidth=n,this._grid=r.create(e,n)}return t.create=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(t,arguments,function(){})},t.prototype.generate=function(e,t,n){var i;return i=this._cellMetadata(e,n),this._grid.generate(i,t)},t.prototype._cellMetadata=function(t,n){var i,r;return r=function(e,t){return e[t]=t,e},i=n.reduce(r,{}),e.map(t,function(e){return function(t){var n;return n=i[t.id],n||t.isLoaded&&!t.thumbnailUrl?e._buildFileIconViewMetadata(t):t.isLoaded?e._buildImageViewMetadata(t):e._buildLoadingImageViewMetadata(t)}}(this))},t.prototype._buildFileIconViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:s,width:l,height:c,attachment:e}},t.prototype._buildLoadingImageViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:null,width:y,height:m,attachment:e}},t.prototype._buildImageViewMetadata=function(e){var t,n,i,r,s;return i=e.thumbnailUrl,n=this._calculateThumbnailDimensions(e.thumbnailDimensions),s=n.width,t=n.height,r=n.variant,0!==i.indexOf("data:")&&(i=E(i,r)),{id:e.id,view:o,scaledThumbnailUrl:i,width:s+2*u,height:t+2*u,attachment:e}},t.prototype._calculateThumbnailDimensions=function(e){var t,n,i,r;return e&&(r=I.AGGREGATED_SCALED,t=e.width/e.height,n=m,i=Math.floor(t*n),i>this._columnWidth-2*u&&(r=I.AGGREGATED_WIDE_CROPPED,i=this._columnWidth-2*u)),(!e||g>i)&&(r=I.AGGREGATED_CROPPED,i=y,n=m),{width:i,height:n,variant:r}},t}()})}.call(this),function(){var e=[].slice;define("modules/clean/recent_activity/react/pending_attachment_list_view",["external/underscore","external/classnames","external/react"],function(t,n,i){var r,o,s;return s=i.DOM,r=4,o=i.createClass({displayName:"PendingAttachmentListView",propTypes:function(){return{count:i.PropTypes.number.isRequired}},render:function(){var i,o;return o=t.times(Math.min(this.props.count,r),function(e){return s.li({className:"attachment-item attachment-item--placeholder"})}),i={"attachment-list":!0,"attachment-list--is-pending":!0,"attachment-list--standalone":1===this.props.count},s.div({className:"recents-item__attachments"},s.ul.apply(s,[{ref:"attachmentsList",className:n(i)}].concat(e.call(o))))}})})}.call(this),function(){define("modules/clean/recent_activity/react/recent_activity_blank_slate_view",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/react/button","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/react/recent_activity_onboarding_modal","modules/clean/recent_activity/react/recent_activity_onboarding_view"],function(e,t,n,i,r,o,s,a,c){var l,u,h,d,p,_,m,f,g,v,y,w,I;return y=i._,w=r.button,p=o.Modal,m=s.RECENT_EVENT_FILTER_TYPE,I=n.DOM,l=m.ALL,_=m.PHOTOS,v=m.VIDEOS,h=m.DOCUMENTS,u=m.COMMENTS,d=m.JUNK,g=m.UNCATEGORIZED,f=n.createClass({displayName:"RecentActivityBlankSlateView",propTypes:{filter:n.PropTypes.oneOf(e.values(m)).isRequired},_heading:function(){switch(this.props.filter){case l:return y("Pick up where you left off");case _:return y("You don’t have any recent images");case v:return y("You don’t have any recent videos");case h:return y("You don’t have any recent documents");case u:return y("You don’t have any recent comments");case d:return y("You don’t have any other recent files");default:return y("You don’t have any files matching this filter")}},_subheadingMarkup:function(){var e;return e=function(){switch(this.props.filter){case l:return c.onboardingMessageMarkup();case _:return y("When you add or edit an image, you’ll see it here.");case v:return y("When you add or edit a video, you’ll see it here.");case h:return y("When you add or edit an Office document or PDF, you’ll see it here.");case u:return y("When someone comments on one of your documents, you’ll see it here.");case d:return y("You’ll only see unimportant files here, like files created automatically by programs.")}}.call(this),{__html:e}},_filterName:function(){switch(this.props.filter){case l:return"all";case _:return"photos";case v:return"videos";case h:return"documents";case u:return"comments";case d:return"junk"}},render:function(){var e,i,r,o,s;return r=I.h1({ref:"heading",className:"recents-blankslate__heading recents-blankslate--show-image"},this._heading()),s=I.p({ref:"subheading",className:"recents-blankslate__subheading",dangerouslySetInnerHTML:this._subheadingMarkup()}),o=n.createElement(a),e=n.createElement(w,{ref:"button",className:"recents-blankslate__button",onClick:function(){return p.showInstance(o)}},y("Learn about recents")),i=["recents-blankslate","recents-blankslate--"+this._filterName()],I.div({className:t.apply(null,i)},r,s,e)}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/recent_activity/react/recent_activity_item_actions_view",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/gandalf_util","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/recent_activity/recent_activity_constants","modules/clean/unity/features"],function(t,n,i,r,o,s,a,c,l,u){var h,d,p,_,m,f,g,v,y;return f=r._,y=r.ungettext,h=s.BubbleMenu,d=s.BubbleMenuItem,p=s.BubbleMenuSeparator,_=l.RECENT_EVENT_TYPES,g=i.createElement,v=i.DOM,m=i.createClass({displayName:"RecentActivityItemActionsView",propTypes:{handleOpen:i.PropTypes.func,handleDelete:i.PropTypes.func,handleSelectAll:i.PropTypes.func,handleDeselectAll:i.PropTypes.func,handleDownload:i.PropTypes.func,handleVersions:i.PropTypes.func,handleComment:i.PropTypes.func,onShowTooltip:i.PropTypes.func,onHideTooltip:i.PropTypes.func,selectCount:i.PropTypes.number,attachmentCount:i.PropTypes.number,disableActions:i.PropTypes.bool,type:i.PropTypes.oneOf(t.values(_)),isMaestroDesign:i.PropTypes.bool},getDefaultProps:function(){return{handleOpen:function(){},handleDelete:function(){},handleSelectAll:function(){},handleDeselectAll:function(){},handleDownload:function(){},handleVersions:function(){},handleComment:function(){},onShowTooltip:function(){},onHideTooltip:function(){},selectCount:0,attachmentCount:1,disableActions:!1,isMaestroDesign:!1}},_onOpen:function(e){return e.preventDefault(),this.props.handleOpen()},_onDelete:function(e){return e.preventDefault(),this.props.handleDelete()},_onSelectAll:function(e){return e.preventDefault(),this.props.handleSelectAll()},_onDeselectAll:function(e){return e.preventDefault(),this.props.handleDeselectAll()},_onDownload:function(e){return e.preventDefault(),this.props.handleDownload()},_onComment:function(e){return e.preventDefault(),this.props.handleComment()},_onVersions:function(e){return e.preventDefault(),this.props.handleVersions()},_moreActionHandler:function(e){return function(t){return function(t){return e(t)}}(this)},_isSharedLink:function(){var t,n;return n=[_.FILE_SHARED_ADD,_.FILE_SHARED_VIEW],t=this.props.type,e.call(n,t)>=0},_renderMoreActionsList:function(){var e,t,n,i,r,o,s;for(r=[{name:"open",displayName:f("Open"),icon:"open",handler:this._onOpen,shouldShow:function(e){return function(){return u&&e.props.handleOpen}}(this)},{name:"download",displayName:this.props.selectCount>1?f("Download (%(num)s)").format({num:this.props.selectCount}):f("Download"),icon:"download",handler:this._onDownload,shouldShow:function(e){return function(){return e.props.handleDownload}}(this)},{name:"comment",displayName:f("Comment"),icon:"s_file_comment",handler:this._onComment,shouldShow:function(e){return function(){return e.props.handleComment}}(this)},{name:"delete",displayName:this.props.selectCount>1?f("Delete (%(num)s)…").format({num:this.props.selectCount}):f(0===this.props.selectCount&&this.props.attachmentCount>1?"Delete all…":"Delete…"),icon:"delete_16",handler:this._onDelete,shouldShow:function(e){return function(){return e.props.handleDelete}}(this)},{name:"versions",displayName:f("Previous versions"),icon:"previous_versions",handler:this._onVersions,shouldShow:function(e){return function(){return e.props.handleVersions}}(this)},{name:"select",displayName:f("Select all"),icon:"select",handler:this._onSelectAll,shouldShow:function(e){return function(){return e.props.attachmentCount>1&&e.props.selectCount>0&&e.props.selectCount<e.props.attachmentCount}}(this)},{name:"deselect",displayName:f("Deselect all"),icon:"deselect",handler:this._onDeselectAll,shouldShow:function(e){return function(){return e.props.attachmentCount>1&&e.props.selectCount>0}}(this)}],o=[],e=0,t=r.length;t>e;e++)i=r[e],i.shouldShow()&&(s=g(c,{group:"web",name:i.icon,text:i.displayName,alt:""}),n=g(d,{className:"recents-actions-list__item recents-actions-list__item--"+i.name,key:i.name,onClick:this._moreActionHandler(i.handler)},s),o.push(n));return o},
_renderMoreActionsButton:function(){var e,t,i,r,o;return e={"recents-item__actions-button":!0,"button-secondary":!0,disabled:this.props.disableActions},this.props.isMaestroDesign?i=v.button({className:n(e),tabIndex:0},"°°°"):(t=g(a,{group:"web",name:"more",alt:f("More actions")}),i=v.button({className:n(e),tabIndex:0},t)),this.props.disableActions&&!this.props.isMaestroDesign?i:(r=this._renderMoreActionsList(),o=g(h,{targetButton:i,arrow_position:"top",bubbleDropdownShown:this.props.onShowTooltip,bubbleDropdownHidden:this.props.onHideTooltip,items:r,position:h.POSITIONS.BOTTOM,ref:"moreActionDropdown"}))},_renderActionsPlaceholder:function(){return this.props.isMaestroDesign?v.span({className:"more-actions-placeholder"},"°°°"):i.createElement(a,{className:"recents-item__more-actions-placeholder",group:"web",name:"overflow-glyph",alt:"…"})},render:function(){var e,t,i;return t={"recents-item__more-actions":!0,"recents-item__more-actions--disabled":this.props.disableActions},this._isSharedLink()?v.div({className:n(t)}):(e=v.div({className:"recents-item__more-actions-button recents-item__action-button",tabIndex:-1},this._renderMoreActionsButton()),i=this.props.isMaestroDesign?null:this._renderActionsPlaceholder(),v.div({className:n(t)},i,e))}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},t=[].slice;define("modules/clean/recent_activity/react/recent_activity_item_header_view",["external/underscore","external/classnames","external/react","modules/clean/accessibility/utils","modules/clean/react/helpers","modules/clean/react/file_icon_view","modules/clean/react/sprite","modules/clean/recent_activity/recent_activity_view_helper","modules/clean/recent_activity/recent_activity_constants"],function(n,i,r,o,s,a,c,l,u){var h,d,p,_,m,f;return p=o.accessibleTriggerProps,_=s.compareStateAndProps,f=l.ensureUserIntentToClick,h=u.RECENT_EVENT_TYPES,m=r.DOM,d=r.createClass({displayName:"RecentActivityItemHeaderView",propTypes:{header:r.PropTypes.shape({heading:r.PropTypes.node,icon:r.PropTypes.string,subheading:r.PropTypes.node,thumbnailUrl:r.PropTypes.string}),handleClick:r.PropTypes.func,handleHeadingContextMenu:r.PropTypes.func,tooltipShown:r.PropTypes.bool,recentActivityType:r.PropTypes.oneOf(n.values(h))},getDefaultProps:function(){return{handleClick:function(){},handleHeadingContextMenu:function(){},tooltipShown:!1}},getInitialState:function(){return{hasThumbnailErrored:!1}},_handleLoadError:function(){return this.setState({hasThumbnailErrored:!0})},shouldComponentUpdate:_,_renderIcon:function(){var e;return e=r.createElement(a,{icon:this.props.header.icon,className:"recents-item__img",src:this.props.header.thumbnailUrl}),m.div({className:"recents-item__icon"},e)},_renderHeading:function(){var e,t;return t=p(this.props.handleClick),e=n.extend(t,{ref:"heading",className:"recents-item__heading",onContextMenu:this.props.handleHeadingContextMenu}),m.a(e,this.props.header.heading)},_renderActions:function(){var t,n,r,o;return o=[h.FILE_SHARED_ADD,h.FILE_SHARED_VIEW],r=this.props.recentActivityType,e.call(o,r)>=0?null:(t={"recents-item__actions-inner":!0,"recents-item__actions-inner--tooltip-shown":this.props.tooltipShown},n=m.div({className:i(t)},this.props.children),m.div({ref:"actions",className:"recents-item__actions"},n))},render:function(){var e,n,i,o,s,a,c;return a=this._renderIcon(),s=this._renderHeading(),o=[],o.push(s),this.props.header.subheading&&(c=m.div({className:"recents-item__subheading",ref:"subheading"},this.props.header.subheading),o.push(c)),i=m.div.apply(m,[{ref:"recentsItemDetails",className:"recents-item__details"}].concat(t.call(o))),n=[a,i],r.Children.count(this.props.children)>0&&(e=this._renderActions(),n.push(e)),m.div.apply(m,[{className:"recents-item__wrapper",onClick:f(this.props.handleClick)}].concat(t.call(n)))}})})}.call(this),function(){define("modules/clean/recent_activity/react/recent_activity_onboarding_modal",["external/underscore","external/react","modules/core/i18n","modules/clean/browse_interface","modules/clean/react/button","modules/clean/react/modal"],function(e,t,n,i,r,o){var s,a,c,l,u;return c=n._,l=r.button,s=o.Modal,u=t.DOM,a=t.createClass({displayName:"RecentActivityOnboardingModal",propTypes:{onConfirm:t.PropTypes.func},getDefaultProps:function(){return{onConfirm:function(){}}},_getBrowseInfoMarkup:function(){var t,n,r;return r=i.get_all_browse_roots(),n=r[0],t=r[1],t?c("You can see all your files and folders by going to <span class='recents-onboarding-modal__body__normal'><a href='%(primary_path)s'> %(primary_name)s</a></span> or <span class='recents-onboarding-modal__body__normal'> <a href='%(paired_path)s'>%(paired_name)s</a></span> on the left.").format({primary_name:e.escape(n.name),primary_path:e.escape(n.path),paired_name:e.escape(t.name),paired_path:e.escape(t.path)}):c("You can see all your files and folders by going to <span class='recents-onboarding-modal__body__normal'> <a href='%(path)s'>%(name)s</a></span> on the left.").format({name:e.escape(n.name),path:e.escape(n.path)})},render:function(){var e;return e=this._getBrowseInfoMarkup(),t.createElement(s,{className:"recents-onboarding-modal",style:"clean",acceptButtonText:c("Got it"),onAccept:this.props.onConfirm,autoFocusPrimaryInput:!1},u.div({},u.div({className:"recents-onboarding-modal__header"},u.h1({className:"recents-onboarding-modal__header__text"},c("Get started with Recents"))),u.div({className:"recents-onboarding-modal__body"},u.h2({className:"recents-onboarding-modal__subheader"},c("Find important files fast")),u.p({className:"recents-onboarding-modal__p"},c("Files you’re opening often will stay at the top of your Recents list, so you can get back to them when you need them.")),u.h2({className:"recents-onboarding-modal__subheader"},c("Share files you’ve just edited")),u.p({className:"recents-onboarding-modal__p"},c("When you add or edit files, you’ll see them in Recents. That way, you can find and share them right away.")),u.h2({className:"recents-onboarding-modal__subheader"},c("See photos you’ve just taken ")),u.p({className:"recents-onboarding-modal__p"},c("If your photos are saved to Dropbox, you can get to them easily from Recents. You can open or download recent photos right from there.")))))}})})}.call(this),function(){define("modules/clean/recent_activity/react/recent_activity_onboarding_view",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/browse_interface","modules/clean/react/button","modules/clean/react/modal","modules/clean/recent_activity/react/recent_activity_onboarding_modal","modules/clean/recent_activity/recent_activity_logger_utils"],function(e,t,n,i,r,o,s,a,c){var l,u,h,d,p;return h=i._,d=o.button,l=s.Modal,p=n.DOM,u=n.createClass({statics:{onboardingMessageMarkup:function(){return h("Find what you need fast with Recents, a list of files you’ve worked on lately.")}},displayName:"RecentActivityOnboardingView",propTypes:{onConfirm:n.PropTypes.func,showNewFeatureMessage:n.PropTypes.bool,userId:n.PropTypes.number.isRequired},getDefaultProps:function(){return{onConfirm:function(){}}},_onConfirm:function(){return this.props.onConfirm(),c.logOnboardingClosed(this.props.userId)},_onLearnMore:function(){var e;return e=n.createElement(a,{onConfirm:this._onModalClosed}),l.showInstance(e),c.logOnboardingLearnMore(this.props.userId)},_onModalClosed:function(){return this.props.onConfirm(),c.logOnboardingModalClosed(this.props.userId)},_getDescMarkup:function(){return{__html:u.onboardingMessageMarkup()}},render:function(){var e,t,i,r,o,s;return o=h(this.props.showNewFeatureMessage?"New feature! A shortcut to the files you need":"A shortcut to the files you need"),r=p.div({ref:"header",className:"recents-onboarding__header"},o),i=p.div({ref:"subheader",className:"recents-onboarding__desc",dangerouslySetInnerHTML:this._getDescMarkup()}),e=n.createElement(d,{ref:"button",className:"recents-onboarding__button",onClick:this._onLearnMore},h("Tell me more")),t=n.createElement(d,{ref:"confirm",className:"recents-onboarding__confirm",onClick:this._onConfirm},h("Got it")),s=p.div({className:"recents-onboarding__wrapper"},r,i,e,t),p.div({className:"recents-onboarding"},s)}})})}.call(this),function(){define("modules/clean/recent_activity/react/selectable_view",["external/classnames","external/react","external/underscore","modules/clean/accessibility/utils","modules/clean/react/helpers","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,r,o,s){var a,c,l,u,h,d;return u=i.accessibleTriggerProps,h=r.compareStateAndProps,l=s._,d=t.DOM,a=t.PropTypes,c=t.createClass({displayName:"SelectableView",propTypes:{id:a.string,handleToggleSelect:a.func,isSelected:a.bool},getDefaultProps:function(){return{handleToggleSelect:function(){},isSelected:!1}},shouldComponentUpdate:h,_handletoggleSelected:function(e){return e.preventDefault(),e.stopPropagation(),this.props.handleToggleSelect(this.props.id,!this.props.isSelected)},render:function(){var e,i,r,s;return e=l(this.props.isSelected?"Deselect":"Select"),r=t.createElement(o,{group:"web",name:"white_check",alt:e}),i=d.span({className:"attachment-item__checkmark-inner"},r),s=n.extend(u(this._handletoggleSelected),{className:"attachment-item__checkmark"}),d.a(s,i)}})})}.call(this),function(){define("modules/clean/recent_activity/recent_activity_client",["jquery","external/underscore","modules/clean/ajax","modules/constants/python","modules/core/exception","external/tracekit"],function(e,t,n,i,r,o){var s,a,c,l,u,h,d,p,_,m,f,g,v,y,w;return d="ok",l="/recents/json",a="/activity/generate/json",c="/recents/logger",h="/recents/mark_onboarding_as_seen",s="/recents/check_files_in_root_collection",u="/recents/create_collection_shared_link",f=function(e,t){return function(n){return n.status===d?t(n):e.reject(new Error("Payload not okay: "+n))}},m=function(e,t){return function(n,i,s){var a,c,l,u,h,d,p,_;return l=function(e){return e.split("\n").map(function(e){return"    "+e}).join("\n")},c="Failed XHR request for "+t+":\nException: "+(null!=(u=s.stack)?u:s)+"\nResponse Status: "+JSON.stringify(n.status)+" "+n.statusText+"\nResponse Headers:\n"+l(n.getAllResponseHeaders()||"[No Headers]")+"\nResponse Body:\n"+l(null!=(h=n.responseText)?h:"[No Body]"),a=new Error(c),a.xhr=n,"abort"!==i&&(p=s instanceof Error?r.SEVERITY.CRITICAL:r.SEVERITY.NONCRITICAL,_=o.computeStackTrace(s),r._reportException({msg:c,stack:null!=(d=null!=_?_.stack:void 0)?d:[],tags:["recents"],severity:p})),e.reject(a)}},v=function(t,i){var r;return r=e.Deferred(),n.WebRequest({url:l,type:"get",subject_user:t,data:{num_activities:20,cursor:i},dataType:"json",success:f(r,function(e){return r.resolve({recentActivities:e.payload.recent_activities,cursor:e.payload.cursor,encrypted:e.payload.encrypted})}),error:m(r,l)}),r.promise()},g=function(r,o,s){var c;return c=e.Deferred(),n.WebRequest({url:a,type:"post",subject_user:r,data:{activity_keys:JSON.stringify(t.unique(o)),loading_modes:JSON.stringify([i.FILE_ACTIVITY_LOADING_MODE.PREVIEW_INFO]),encrypted:s},dataType:"json",success:f(c,function(e){return c.resolve(e.payload.activities_by_activity_key)}),error:m(c,a)}),c.promise()},w=function(e,t){return n.SilentBackgroundRequest({url:c,type:"post",subject_user:e,data:t,error:function(e,t,n){if("abort"!==t)throw new Error("Failed XHR request for "+c+": "+n)}})},y=function(e){return n.WebRequest({url:h,type:"post",subject_user:e,error:function(e,t,n){if("abort"!==t)throw new Error("Failed XHR request for "+h+": "+n)}})},p=function(t,i){var r;return r=e.Deferred(),n.WebRequest({url:s,type:"post",subject_user:t,data:{files_json:JSON.stringify(i)},dataType:"json",success:f(r,function(e){return r.resolve({fileInRootCollectionInfo:e.payload.file_in_root_collection_info})}),error:m(r,s)}),r.promise()},_=function(t,i){var r;return r=e.Deferred(),n.WebRequest({url:u,type:"post",subject_user:t,data:{files_json:JSON.stringify(i)},dataType:"json",success:f(r,function(e){return r.resolve({link:e.payload.link,tkey:e.payload.tkey,shareableItemCount:e.payload.shareable_item_count})}),error:m(r,u)}),r.promise()},{fetchRecentActivities:v,fetchActivitiesByKey:g,postLogEvent:w,markOnboardingAsSeen:y,checkFileInRootCollection:p,createCollectionSharedLink:_}})}.call(this),function(){define("modules/clean/recent_activity/recent_activity_constants",["modules/constants/python"],function(e){var t,n;return n=e.RECENT_EVENT_TYPES,t=e.RECENT_EVENT_FILTER_TYPE,{RECENT_EVENT_TYPES:n,RECENT_EVENT_FILTER_TYPE:t,RECENT_CREATE_FILTER:"createFilter",ActionTypes:{RECEIVE_RAW_RECENT_ACTIVITIES:"RECEIVE_RAW_RECENT_ACTIVITIES",RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:"RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY",RECEIVE_CAN_OPEN_INFO:"RECEIVE_CAN_OPEN_INFO",RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:"RECEIVE_FILE_IN_ROOT_COLLECTION_INFO",DELETE_FILES_PENDING:"DELETE_FILES_PENDING",DELETE_FILES_COMMIT:"DELETE_FILES_COMMIT",DELETE_FILES_ROLLBACK:"DELETE_FILES_ROLLBACK",SELECT_ATTACHMENTS:"SELECT_ATTACHMENTS",DESELECT_ATTACHMENTS:"DESELECT_ATTACHMENTS",RAW_RECENT_ACTIVITY_PARSE_ERROR:"RAW_RECENT_ACTIVITY_PARSE_ERROR",RAW_RELATED_ACTIVITY_PARSE_ERROR:"RAW_RELATED_ACTIVITY_PARSE_ERROR"},TransactionPrefixes:{DELETE_FILES:"DELETE_FILES",MOVE_FILES:"MOVE_FILES"},MAX_INITIAL_DOC_ATTACHMENTS:3,SHOW_MORE_DOC_ATTACHMENT_INCREMENT:10,MAX_INITIAL_THUMBNAIL_ATTACHMENTS:8,SHOW_MORE_THUMBNAIL_ROW_INCREMENT:4}})}.call(this),function(){define("modules/clean/recent_activity/recent_activity_dispatcher",["external/flux"],function(e){var t;return new(t=e.Dispatcher)})}.call(this),function(){define("modules/clean/recent_activity/recent_activity_logger",["external/underscore","modules/constants/env","modules/core/exception","modules/clean/recent_activity/recent_activity_client"],function(e,t,n,i){var r,o,s,a,c,l,u,h,d,p,_,m,f,g,assert,v,y,w;return l=t.IS_PROD,assert=n.assert,d="client_page_loaded",_="request_failed",s="cell_action",f="time_to_first_action",u="onboarding_action",p=["is_full_page","item_count","contains_aggregation","latency","is_paginated"],m=["failure_type","is_paginated"],a=["in_aggregation","filter_view","action_type","target_activity_type","action_scope","position","file_extension","days_ago"],g=["latency","action_type","action_scope"],h=["action_type"],c={EVERYTHING:"everything"},o={VIEW_FILE:"view",OPEN:"open",SHARE:"share",SHARE_COLLECTION:"share_collection",DELETE:"delete",HIDE:"hide",UNITY_OPEN:"unity_open",OPEN_DIR:"open_dir",REPORT_JUNK:"report_junk",COMMENT:"comment",DOWNLOAD:"download",VERSIONS:"versions",VIEW_SHARED_LINK:"view_shared_link"},r={SINGLE:"single",SUBSET:"subset",AGGREGATION:"aggregation"},v=!!l,y=function(t,n,r){return null==r&&(r={}),v?(r=e.clone(r),r.event_name=n,i.postLogEvent(t,r)):void 0},w=function(t,n,i){var r,o,s;return r=e.keys(i),o=e.difference(n,r),assert(0===o.length,t+" is missing keys: "+o),s=e.difference(r,n),assert(0===s.length,t+" called with unsupported keys: "+s)},{FilterViews:c,ActionTypes:o,ActionScopes:r,enableLogging:function(){return v=!0},disableLogging:function(){return v=!1},isLoggingEnabled:function(){return v},logPageLoaded:function(e,t){return w("logPageLoaded",p,t),y(e,d,t)},logRequestFailed:function(e,t){return w("logRequestFailed",m,t),y(e,_,t)},logCellAction:function(e,t){return w("logCellAction",a,t),y(e,s,t)},logTimeToFirstAction:function(e,t){return w("logTimeToFirstAction",g,t),y(e,f,t)},logOnboardingAction:function(e,t){return w("logOnboardingAction",h,t),y(e,u,t)}}})}.call(this),function(){define("modules/clean/recent_activity/recent_activity_logger_utils",["jquery","external/react-dom","external/underscore","modules/core/exception","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_logger","modules/clean/web_timing_logger"],function(e,t,n,i,r,o,s){var a,c,l,u,h,d,p,_,m,f,g,v,assert,y,w,I,E,T,b,C;return assert=i.assert,m=r.RECENT_EVENT_FILTER_TYPE,a=m.ALL,_=m.PHOTOS,g=m.VIDEOS,h=m.DOCUMENTS,u=m.COMMENTS,p=m.JUNK,v=m.VISUAL_NOTES,f=m.UNCATEGORIZED,d=o.FilterViews,l=o.ActionTypes,c=o.ActionScopes,E=T=!1,I=function(e){return Math.floor((Date.now()-e)/864e5)},b=function(i,r,s,a,l){var u,h,p,_,m,f;return assert(n.isArray(s),"fqPaths must be an Array"),u=e(t.findDOMNode(l)),h=u.closest(".recents-item"),m=n.uniq(n.map(s,function(e){return e.split(".").pop().toLowerCase()})),f=a>1,p=1===a?c.SINGLE:s.length===a?c.AGGREGATION:c.SUBSET,_={in_aggregation:f,filter_view:d.EVERYTHING,action_type:i,action_scope:p,target_activity_type:h.data("item-type"),position:h.prevAll().length,file_extension:m.join(","),days_ago:I(h.data("item-date"))},o.logCellAction(r,_),C(r,n.pick(_,"action_scope","action_type"))},C=function(e,t){return!T&&s.start_time()?(T=!0,t=n.clone(t),t.latency=Date.now()-s.start_time(),o.logTimeToFirstAction(e,t)):void 0},w=function(e){return function(t,i,r,o){return assert(n.isNumber(t),e+" logger expected user id but got: "+typeof t),assert(n.isArray(i),e+" logger expected array of fqPaths but got: "+typeof i),assert(n.isNumber(r),e+" logger expected a totalCount but got: "+typeof r),assert(n.isObject(o),e+" logger expected a React element but got: "+typeof o),b(e,t,i,r,o)}},y=function(e){return function(t,i,r,o){return assert(n.isString(i),e+" log function expected a fqPath but got: "+i),w(e)(t,[i],r,o)}},{logShareFile:y(l.SHARE),logShareCollection:w(l.SHARE_COLLECTION),logPreviewFiles:w(l.VIEW_FILE),logDeleteFiles:w(l.DELETE),logUnityOpenFile:y(l.UNITY_OPEN),logOpenPathUrl:w(l.OPEN_DIR),logOpenSharedLinkUrl:w(l.VIEW_SHARED_LINK),logCommentFile:y(l.COMMENT),logDownloadFile:w(l.DOWNLOAD),logOpenVersions:y(l.VERSIONS),logOnboardingClosed:function(e){return o.logOnboardingAction(e,{action_type:"onboarding_dismissed"})},logOnboardingLearnMore:function(e){return o.logOnboardingAction(e,{action_type:"full_onboarding_opened"})},logOnboardingModalClosed:function(e){return o.logOnboardingAction(e,{action_type:"full_onboarding_dismissed"})},logRequestFailed:function(e,t){return o.logRequestFailed(e,{failure_type:t.xhr.status,is_paginated:!1})},startRequestTimer:function(){var e,t;return t=Date.now(),e=!1,!E&&s.start_time()&&(e=!0,t=s.start_time(),E=!0),function(i,r){return null==r&&(r={}),r=n.defaults(r,{is_full_page:e}),r.latency=Date.now()-t,o.logPageLoaded(i,r)}},reset:function(){return E=T=!1}}})}.call(this),function(){define("modules/clean/recent_activity/recent_activity_text_helper",["modules/core/i18n","modules/clean/em_string"],function(e,t){var n,i,r;return r=e.ungettext,n=function(e,t){return r("%(name)s and %(num)s other","%(name)s and %(num)s others",t).format({name:e,num:t})},i=function(e,i,o){var s,a,c,l,u,h,d;if(null==o&&(o={}),d=Math.max(parseInt(o.totalCount,10)||0,e.length),1===d)return t.em_snippet(e[0],i);for(c=e[0],h=d-1,a=n(c,h),t(a).length>i&&(s=Math.floor(i-t(n("",h)).length)-1,a=3>s?r("%(num)s other","%(num)s others",d).format({num:d}):n(t.em_snippet(c,s),h)),l="",u=1;u<e.length&&(u+=1,l=e.slice(0,u).join(", "),d>u&&(l=n(l,d-u)),t(l).length<i);)a=l;return a},{snippetList:i}})}.call(this),function(){define("modules/clean/recent_activity/recent_activity_view_helper",[],function(){var e;return e=function(e){return function(t){var n,i;if(!window.getSelection().toString()){for(n=t.target;n&&n.parentNode&&n!==t.currentTarget;){if("a"===(i=n.nodeName.toLowerCase())||"button"===i)return;n=n.parentNode}return e.apply(this,arguments)}}},{ensureUserIntentToClick:e}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/recent_activity/recent_activity_view_models",["external/underscore","external/react","external/immutable","modules/clean/browse_interface","modules/clean/recent_activity/recent_activity_constants","modules/clean/viewer"],function(t,n,i,r,o,s){var a,c,l,u,h,d,p,_,m,f,g,v,y,w;return u=o.RECENT_EVENT_FILTER_TYPE,h=o.RECENT_EVENT_TYPES,l=n.PropTypes,a=i.Record({id:null,isLoaded:!1,displayName:null,viewingUserId:null,entityUri:null,previewInfo:null,fqPath:null,nsPath:null,nsId:null,thumbnailUrl:null,thumbnailDimensions:null,canOpen:!1,inRootCollection:!1,isReadOnly:!1,isDir:!1,commentRawText:null,commenterId:null,commenterDisplayName:null,commenterPhotoUrl:null},"AttachmentRecord"),a.PropTypes=l.shape({id:l.string.isRequired,isLoaded:l.bool.isRequired,viewingUserId:l.number.isRequired,displayName:l.string,entityUri:l.string,previewInfo:l.object,fqPath:l.string,nsPath:l.string,nsId:l.number,thumbnailUrl:l.string,thumbnailDimensions:l.object,canOpen:l.bool,inRootCollection:l.bool,isReadOnly:l.bool,isDir:l.bool,commentRawText:l.string,commenterId:l.number,commenterDisplayName:l.string,commenterPhotoUrl:l.string}),d=i.Record({id:null,type:null,icon:null,when:null,viewingUserId:null,displayName:null,accountDisplayName:null,contextDisplayName:null,filterTypesByKey:{},attachmentIds:i.List(),paths:i.List(),duplicateIds:i.List(),order:null},"RecentItemRecord"),d.PropTypes=l.shape({id:l.string.isRequired,type:l.number.isRequired,icon:l.string.isRequired,when:l.number.isRequired,viewingUserId:l.number.isRequired,displayName:l.string.isRequired,accountDisplayName:l.string.isRequired,contextDisplayName:l.string.isRequired,filterTypesByKey:l.object.isRequired,attachmentIds:l.arrayOf(l.string).isRequired,paths:l.arrayOf(l.object).isRequired,duplicateIds:l.arrayOf(l.number).isRequired,order:l.number.isRequired}),c=i.Record({name:null,url:null},"PathRecord"),p=i.Record({width:null,height:null},"SizeRecord"),_=0,m=t.memoize(function(e){return _+=1}),g=function(e){var t,n;return n=e.skeleton_data,t=e.activity_key,new d({id:t,type:e.recent_event_type,icon:n.icon,when:e.when_milli,viewingUserId:e.viewing_user.id,displayName:n.display_name,accountDisplayName:n.account_display_name,contextDisplayName:n.context_display_name,filterTypesByKey:Object.freeze(n.filter_types_by_key),attachmentIds:i.List(e.related_activity_keys),paths:y(n.context_display_path,e.viewing_user.id,{isDir:!0}),duplicateIds:i.List(e.related_activity_keys).map(function(e){return n.related_activity_dupids_by_activity_key[e]}),order:m(t)})},f=function(e){var t,n,i,r,o,s,c,l,u,h;return n=e.preview_jsinfo||null,(null!=n?n.thumbnail_url_tmpl:void 0)&&(u=n.thumbnail_url_tmpl),(null!=n?n.thumbnail_dimensions:void 0)&&(i=n.thumbnail_dimensions,h=i[0],t=i[1],l=new p({height:t,width:h})),new a({id:e.activity_key,isLoaded:!0,viewingUserId:e.viewing_user.id,displayName:e.name,entityUri:e.entity_uri,previewInfo:e.preview_jsinfo,fqPath:e.fq_path,nsPath:e.ns_path,nsId:e.ns_id,thumbnailUrl:u,thumbnailDimensions:l||null,canOpen:!1,inRootCollection:!1,isReadOnly:e.is_read_only,isDir:e.is_dir,commentRawText:(null!=(r=e.comment)?r.raw_comment_text:void 0)||null,commenterId:(null!=(o=e.comment)?o.commenter_dict.id:void 0)||null,commenterDisplayName:(null!=(s=e.comment)?s.commenter_dict.display_name:void 0)||null,commenterPhotoUrl:(null!=(c=e.comment)?c.commenter_dict.photo_circle_url:void 0)||null})},v=function(e){var t;return t=e.skeleton,e.related_activity_keys.map(function(t){return new a({id:t,viewingUserId:e.viewing_user.id})})},y=function(e,n,o){var a,l,u,h,d,p,_;for(null==o&&(o={}),_=s.get_viewer(),p=_.get_user_by_id(n),"/"===e&&(e=""),d=[],h=e.split("/"),o.isDir!==!0&&h.pop();h.length;)u=t.last(h),l=h.join("/"),1===h.length&&""===u&&(u=s.get_root_name(p),l=""),a=r.browse_uri_for_fq_path(p,l).toString(),d.push(new c({name:u,url:a})),h.pop();return i.List(d.reverse())},w=function(n){var i,r,o,s,a,c;return a=t.uniq(t.values(n)),i=u.PHOTOS,o=u.VIDEOS,s=u.VISUAL_NOTES,r=[i,o,s],c=function(t){return e.call(r,t)>=0},t.all(a,c)&&t.size(n)>1},{convertRecentActivityToRecentItem:g,convertFileActivityToAttachmentItem:f,createPartialAttachmentsFromRecentActivity:v,shouldShowThumbnails:w,getPathsByFqPath:y,PropTypes:{recentItem:d.PropTypes,attachment:a.PropTypes}}})}.call(this),function(){var e=[].slice;define("modules/clean/recent_activity/store_utils",["jquery","external/underscore","modules/core/notify","modules/clean/gandalf_util","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/stores/attachment_store","modules/clean/unity/features","modules/clean/require_wrapper"],function(t,n,i,r,o,s,a,c,l,u,h,d){var p,_,m,f,g,v,y,w,I,E,T,b,C,S,R,A,k;return p=s.ActionTypes,m=s.MAX_INITIAL_THUMBNAIL_ATTACHMENTS,_=s.MAX_INITIAL_DOC_ATTACHMENTS,A=l.shouldShowThumbnails,f=d.RequireWrapper,S=function(e,t){var n;return null==t&&(t=null),n=o.fetchRecentActivities(e,t),w(n,e,t)},w=function(e,t,i){var r,o,s;return r=c.startRequestTimer(),o=c.logRequestFailed.bind(null,t),s=e.then(n.partial(E,t)).then(null,o),e.then(function(e){var o;return o=e.recentActivities,s.then(function(){var e;return e=n.map(o,function(e){return e.skeleton_data.num_related_activities}),r(t,{is_paginated:!!i,contains_aggregation:n.any(e,function(e){return e>1}),item_count:e.reduce(function(e,t){return e+t},0)})})})},E=function(e,t){var n,i,r;return r=t.recentActivities,n=t.cursor,i=t.encrypted,k(e,r,n,i),C(e,r,n,i)},k=function(e,t,n,i){return a.dispatch({type:p.RECEIVE_RAW_RECENT_ACTIVITIES,rawRecentActivities:t,cursor:n,encrypted:i,userId:e})},C=function(e,t){var i;return i=t.map(function(e){var t;return t=A(e.skeleton_data.filter_types_by_key)?m:_,e.related_activity_keys.slice(0,t)}),b(e,n.flatten(i))},R=function(e){var n,i;return window.__REGISTER_RECENTS_PRELOAD_HANDLER?(i=function(n){var i;return i=t.Deferred(),i.resolve(n),w(i.promise(),e,null)},n=S.bind(null,e),window.__REGISTER_RECENTS_PRELOAD_HANDLER(i,n)):S(e)},b=function(i,r){var s,a;return s=u.groupIdsByEncryptedToken(r),a=n.map(s,function(e,t){return o.fetchActivitiesByKey(i,e,t).then(n.partial(I,i))}),t.when.apply(t,a).then(function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],n.extend.apply(n,[{}].concat(e.call(t)))})},I=function(e,t){return a.dispatch({type:p.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:t}),null!=h&&g(t,e),v(t,e),f.require(["dropbox"]),f.require(["modules/clean/react/file_viewer/controller"]),t},g=function(e,t){var n,i,r;if(e){i=[];for(r in e)n=e[r],i.push({ns_id:n.ns_id,ns_path:n.ns_path});return y(i,t).then(function(e){return a.dispatch({type:p.RECEIVE_CAN_OPEN_INFO,canOpenInfo:e})})}},y=function(e,t){return h.check_file_batch(e,t,function(){})},v=function(e,t){var n,i,r;if(e){i=[];for(r in e)n=e[r],i.push({ns_id:n.ns_id,ns_path:n.ns_path});return o.checkFileInRootCollection(t,i).then(function(e){return a.dispatch({type:p.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO,fileInRootCollectionInfo:e.fileInRootCollectionInfo})})}},T=function(t,r,o){var s,a,c,l;return s=u.getByIds(r),l=s.filter(n.negate(n.property("isLoaded"))).map(n.property("id")),l.length?(c=T.bind.apply(T,[null].concat(e.call(arguments))),a=function(){return i.error(i.DEFAULT_ERROR)},b(t,l).then(c,a)):n.defer(o.bind(this,s))},{ensureAttachments:T,loadAttachments:b,loadAttachmentsForRecentActivities:C,loadRecentItems:S,preloadRecentItems:R,updateRecentActivities:k}})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/recent_activity/stores/attachment_store",["external/underscore","external/immutable","modules/core/exception","modules/clean/filepath","modules/clean/flux/flux_store","modules/clean/recent_activity/transactions","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/actions/error_actions"],function(t,n,i,r,o,s,a,c,l,u){var h,d,p,assert,_,m;return assert=i.assert,h=c.ActionTypes,p=c.TransactionPrefixes,_=l.convertFileActivityToAttachmentItem,m=l.createPartialAttachmentsFromRecentActivity,new(d=function(i){function r(e,i){var o,s,a,c,l,u;null==i&&(i={}),r.__super__.constructor.call(this,e),o=null!=(l=i.attachments)?l:[],s=null!=(u=i.encryptedToken)?u:null,c=t.pluck(o,"id"),this._attachments=n.fromJS(t.object(c,o)),a={},s&&(a=t.object(c.map(function(e){return[e,s]}))),this._encryptedTokens=n.Map(a),this._transactionHistory={}}return e(r,i),r.prototype.getById=function(e){return this._attachments.has(e)?this._attachments.get(e).toJS():null},r.prototype.getByIds=function(e){var i;return i=n.List(e).map(function(e){return function(t){return e._attachments.get(t,null)}}(this)),i.filterNot(t.isNull).toJS()},r.prototype.getByFqPath=function(e){var t;return t=this._attachments.find(function(t){return t.get("fqPath")===e}),t?t.toJS():null},r.prototype.getAll=function(){return this._attachments.toList().toJS()},r.prototype.groupIdsByEncryptedToken=function(e){var n,i;return n="__missing__",i=t.groupBy(e,function(e){return function(t){return e._encryptedTokens.get(t)||n}}(this)),t.omit(i,n)},r.prototype.__onDispatch=function(e){if(!s.handleTransaction(p.DELETE_FILES,e,{onPending:this._onDeleteFilesPending.bind(this),onCommit:this._onCommit.bind(this),onRollback:this._onDeleteFilesRollback.bind(this)}))switch(e.type){case h.RECEIVE_RAW_RECENT_ACTIVITIES:return this._onReceiveRawRecentActivities(e);case h.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:return this._onReceiveRawRelatedActivitiesByKey(e);case h.RECEIVE_CAN_OPEN_INFO:return this._onReceiveCanOpenInfo(e);case h.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:return this._onReceiveFileInRootCollectionInfo(e)}},r.prototype._updateAttachments=function(e){var t;return t=this._attachments,this._attachments=this._attachments.withMutations(e),this._attachments!==t?this.__emitChange():void 0},r.prototype._onCommit=function(e){return delete this._transactionHistory[e.transactionId]},r.prototype._onReceiveRawRecentActivities=function(e){var n,i;return n=e.rawRecentActivities.map(function(e){return m(e)}),n=t.compact((i=[]).concat.apply(i,n)),this._updateAttachments(function(t){return function(i){var r;return r={},n.forEach(function(t){return i.has(t.get("id"))||i.set(t.get("id"),t),r[t.get("id")]=e.encrypted}),t._encryptedTokens=t._encryptedTokens.merge(r)}}(this))},r.prototype._onReceiveRawRelatedActivitiesByKey=function(e){var n,i;return i=this._attachments,n=t.map(e.rawRelatedActivitiesByKey,this._createAttachment,this),n=t.compact(n),this._updateAttachments(function(e){return n.forEach(function(t){return e.set(t.get("id"),t)})})},r.prototype._onReceiveCanOpenInfo=function(e){return this._updateAttachments(function(n){return t.each(e.canOpenInfo,function(e,t){var i,r,o,s;return s=t.split(":"),r=s[0],o=s[1],(i=n.find(function(e){return e.get("nsId")===Number(r)&&e.get("nsPath")===o}))?n.setIn([i.get("id"),"canOpen"],e.is_locally_available):void 0})})},r.prototype._onReceiveFileInRootCollectionInfo=function(e){return this._updateAttachments(function(n){return t.each(e.fileInRootCollectionInfo,function(e,t){var i,r,o,s;return s=t.split(":"),r=s[0],o=s[1],i=n.find(function(e){return e.get("nsId")===Number(r)&&e.get("nsPath")===o}),i?n.setIn([i.get("id"),"inRootCollection"],e):void 0})})},r.prototype._onDeleteFilesPending=function(e){var t;return t=[],this._transactionHistory[e.transactionId]={deletedAttachments:t},this._updateAttachments(function(n){var i,r,o,s,a;for(a=e.attachmentIds,r=0,s=a.length;s>r;r++){if(o=a[r],i=n.get(o),!i)return;t.push(i),n.remove(o)}})},r.prototype._onDeleteFilesRollback=function(e){var t;return t=this._transactionHistory[e.transactionId],assert(t,"Unable to find data for transaction with id: "+e.transactionId),this._updateAttachments(function(e){var n,i,r,o,s;for(o=t.deletedAttachments,s=[],i=0,r=o.length;r>i;i++)n=o[i],s.push(e.set(n.get("id"),n));return s})},r.prototype._createAttachment=function(e,n){var i,r;try{return _(e)}catch(e){i=e,t.defer(function(){return u.relatedActivityParseError(n,i);
})}return null},r}(o))(a)})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/recent_activity/stores/recent_activity_store",["external/underscore","external/immutable","modules/core/exception","modules/clean/filepath","modules/clean/flux/flux_store","modules/clean/recent_activity/transactions","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/actions/error_actions","modules/clean/recent_activity/stores/attachment_store"],function(t,i,r,o,s,a,c,l,u,h,d,p){var _,m,f,g,v,assert,y,w;return assert=r.assert,m=c.RECENT_EVENT_FILTER_TYPE,_=u.ActionTypes,v=u.TransactionPrefixes,y=h.convertRecentActivityToRecentItem,w=h.getPathsByFqPath,f=t.values(m),new(g=function(r){function o(e,n,r){o.__super__.constructor.call(this,e),r=i.fromJS(t.object(t.pluck(r,"id"),r)),this._items=r,this._attachmentMap=i.Map(),this._cursors=i.Map(),this._loaded=i.Set(),this._attachmentStore=n,this._didReceiveRecentActivities=!1,this._transactionHistory={},this._regenerateAttachmentMap()}return e(o,r),o.prototype._itemComparator=function(e,t){return e.when===t.when?e.order-t.order:t.when-e.when},o.prototype.getAll=function(){return t.values(this._items.toJS()).sort(this._itemComparator)},o.prototype.didReceiveRecentActivities=function(){return this._didReceiveRecentActivities},o.prototype.cursorForUser=function(e){return this._cursors.get(e,null)},o.prototype.isLoadedForUser=function(e){return this._loaded.contains(e)},o.prototype.getById=function(e){var t;return t=this._items.get(e),t?t=t.toJS():null},o.prototype.filterItemsForUser=function(e,i){var r,o;return assert(n.call(f,i)>=0,"filter must be one of "+f),r=m.ALL,o=m.JUNK,this.getAll().filter(function(s){var a,c;return a=t.values(s.filterTypesByKey),c=i===r&&n.call(a,o)<0,s.viewingUserId===e&&(c||n.call(a,i)>=0)})},o.prototype.__onDispatch=function(e){if(!a.handleTransaction(v.DELETE_FILES,e,{onPending:this._onDeleteFilesPending.bind(this),onCommit:this._onCommit.bind(this),onRollback:this._onDeleteFilesRollback.bind(this)}))switch(e.type){case _.RECEIVE_RAW_RECENT_ACTIVITIES:return this._onReceiveRawRecentActivities(e);case _.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:return this._onReceiveRawRelatedActivitiesByKey(e);case _.RAW_RELATED_ACTIVITY_PARSE_ERROR:return this._onRawRelatedActivityParseError(e)}},o.prototype._onCommit=function(e){return delete this._transactionHistory[e.transactionId]},o.prototype._onReceiveRawRecentActivities=function(e){var n,r,o;return this._didReceiveRecentActivities||e.rawRecentActivities.length?(this._didReceiveRecentActivities=!0,r=e.rawRecentActivities.map(this._createRecentItem,this),r=t.compact(r),this._items=this._items.withMutations(function(e){return r.forEach(function(n){var i,r;return i=e.find(function(e){return e.id!==n.id&&e.contextDisplayName===n.contextDisplayName}),i&&(r=t.intersection(i.attachmentIds.toArray(),n.attachmentIds.toArray()),r.length>0&&e.delete(i.get("id"))),e.set(n.get("id"),n)})}),o=i.Set(),n=this._items.toList().sort(this._itemComparator),n=n.filter(function(e){if(e.attachmentIds&&e.attachmentIds.size>0){if(e.attachmentIds.every(function(e){return o.has(e)}))return!1;o=o.union(e.attachmentIds)}return!0}),this._items=i.Map(n.map(function(e){return[e.get("id"),e]})),this._loaded=this._loaded.add(e.userId),this._cursors=this._cursors.set(e.userId,e.cursor),this._regenerateAttachmentMap(),this.__emitChange()):(this._didReceiveRecentActivities=!0,this.__emitChange(),!0)},o.prototype._onReceiveRawRelatedActivitiesByKey=function(e){var n,r;return this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]),n=t.keys(e.rawRelatedActivitiesByKey),r=i.Set(n).flatMap(function(e){return function(t){return e._attachmentMap.get(t)}}(this)),this._items=this._items.withMutations(function(e){return function(t){return r.forEach(function(i){var r,o,s,a,c;return s=t.get(i),s&&(n=s.get("attachmentIds"),n&&(r=e._attachmentStore.getById(n.first()),r&&r.isLoaded))?(o=r.fqPath,n.slice(1).forEach(function(t){var n;return n=e._attachmentStore.getById(t),n.isLoaded&&n.fqPath.split("/").length<o.split("/").length?o=n.fqPath:void 0}),c=o.split("/"),a=c[c.length-2],a&&t.setIn([i,"contextDisplayName"],a),t.setIn([i,"paths"],w(o,s.get("viewingUserId")))):void 0})}}(this)),this.__emitChange()},o.prototype._onRawRelatedActivityParseError=function(e){return this._items=this._items.withMutations(function(t){return function(n){var r,o,s,a,c,l;for(c=e.errors,l=[],o=0,a=c.length;a>o;o++)r=c[o].activityKey,s=t._attachmentMap.get(r,i.List()),l.push(s.forEach(n.delete,n));return l}}(this)),this.__emitChange()},o.prototype._onDeleteFilesPending=function(e){return this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]),this._transactionHistory[e.transactionId]=this._deleteAttachments(e.attachmentIds),this.__emitChange()},o.prototype._onDeleteFilesRollback=function(e){var t;return this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]),t=this._transactionHistory[e.transactionId],assert(t,"Unable to find data for transaction with id: "+e.transactionId),delete this._transactionHistory[e.transactionId],this._rollbackDelete(t),this.__emitChange()},o.prototype._deleteAttachments=function(e){var n;return n=null,this._items=this._items.withMutations(function(r){return function(o){var s,a,c;return a=r._attachmentMap.get(e[0],i.List()).first(),(s=o.get(a))?(a=s.get("id"),c=t.difference(s.get("attachmentIds").toArray(),e),o.mergeIn([a],{attachmentIds:i.List(c)}),n={deletedAttachmentIds:e,item:o.get(a)},0===c.length?o.delete(a):void 0):void 0}}(this)),n},o.prototype._rollbackDelete=function(e){return this._items=this._items.withMutations(function(t){var n,r,o;return r=e.item.get("id"),n=t.get(r),n||(n=e.item,n=n.setIn(["attachmentIds"],i.List())),o=n.get("attachmentIds").concat(e.deletedAttachmentIds),n=n.merge({attachmentIds:o}),t.set(r,n)})},o.prototype._createRecentItem=function(e){var n,i;try{return y(e)}catch(i){n=i,t.defer(function(){return d.recentActivityParseError(e.activity_key,n)})}return null},o.prototype._regenerateAttachmentMap=function(){var e;return e={},this._items.forEach(function(t){return t.get("attachmentIds").forEach(function(n){var r;return r=e[n],r||(r=i.Set()),e[n]=r.add(t.get("id"))})}),this._attachmentMap=i.Map(e)},o}(s))(l,p)})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/recent_activity/stores/selection_store",["external/underscore","external/immutable","modules/clean/flux/flux_store","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_constants"],function(t,n,i,r,o){var s,a;return s=o.ActionTypes,new(a=function(t){function i(e,t,r){null==t&&(t=null),null==r&&(r=[]),i.__super__.constructor.call(this,e),this._selected=n.Set(r),this._recentItemId=t}return e(i,t),i.prototype.getByRecentItemId=function(e){return e===this._recentItemId?this._selected.toArray():[]},i.prototype.__onDispatch=function(e){switch(e.type){case s.SELECT_ATTACHMENTS:return this._onReceiveSelectAttachments(e);case s.DESELECT_ATTACHMENTS:return this._onReceiveDeselectAttachments(e)}},i.prototype._onReceiveSelectAttachments=function(e){return this._recentItemId!==e.recentItemId&&(this._recentItemId=e.recentItemId,this._selected=this._selected.clear()),this._selected=this._selected.concat(e.attachmentIds),this.__emitChange()},i.prototype._onReceiveDeselectAttachments=function(e){return this._recentItemId!==e.recentItemId&&(this._recentItemId=e.recentItemId,this._selected=this._selected.clear()),this._selected=this._selected.filter(function(t){return-1===e.attachmentIds.indexOf(t)}),this.__emitChange()},i}(i))(r)})}.call(this),function(){define("modules/clean/recent_activity/transactions",["external/underscore"],function(e){var t,n;return n=function(){},t={onPending:n,onCommit:n,onRollback:n},{createTransaction:function(t,n){var i,r;return r=e.uniqueId(t+"_"),i=function(t){return function(i){return i=e.extend({type:t,transactionId:r},i),n.dispatch(i)}},{pending:i(t+"_PENDING"),commit:i(t+"_COMMIT"),rollback:i(t+"_ROLLBACK")}},handleTransaction:function(n,i,r){switch(r=e.extend(t,r),i.type){case n+"_PENDING":r.onPending(i);break;case n+"_COMMIT":r.onCommit(i);break;case n+"_ROLLBACK":r.onRollback(i);break;default:return!1}return!0}}})}.call(this),define("modules/clean/require_wrapper",["require","exports","require"],function(e,t,n){"use strict";var i=function(){function e(){}return e.prototype.require=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return n.apply(void 0,e)},e}();t.RequireWrapper=new i}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=[].slice;define("modules/clean/server_side_client_view_bridge",[],function(){var i,r,o,s,a,c,l,u,h,d,p,_,m,f,g,v,y,w,I,E,T,b,C,S,R,A,k,D,P,N,O,L,x,M,F,V,U,q,B,W,H,G,j,Y,$,K,z,J,Q,X,Z,ee,te,ne,ie,re,oe,se,ae,ce,le,ue,he,de,pe,_e,me,fe,ge;return U=0,M=404,x=-32600,V=-32700,F=-32999,f=function(){function i(){this.resolvePromiseFromDesktopClient=e(this.resolvePromiseFromDesktopClient,this),this.onEventFromDesktopClient=e(this.onEventFromDesktopClient,this),this.messageCounter=0,this.receiveListeners=[],this.callbackMap={},this.deferredInvokeQueue=[],this.hasEstablishedSession=!1,this.hasTransport=!1,this.desktopClientInfo=null,this.desktopClientExportsInfo=null,this.requestHandlers={onEventFromDesktopClient:this.onEventFromDesktopClient,resolvePromiseFromDesktopClient:this.resolvePromiseFromDesktopClient},this.eventHandlers={},this.View={},this.View.PromisedData={},this.sendMessage=function(){},this.close=function(){},"undefined"!=typeof _clientBridge&&null!==_clientBridge&&_clientBridge.enabled&&(this.sendMessage=_clientBridge._SendMessageToDesktopClient,this.close=_clientBridge._Close,this.hasTransport=!0,_clientBridge._RegisterConnection(this))}return i.prototype.onOpen=function(){this.hasEstablishedSession=!0,this._ensureDesktopClientInfo().then(function(e){return function(){var t,n,i,r;for(r=e.deferredInvokeQueue,t=0,i=r.length;i>t;t++)(n=r[t])();return e.deferredInvokeQueue=[]}}(this))},i.prototype.onClose=function(){var e,n,i;this.close(),i=this.callbackMap;for(n in i)t.call(i,n)&&(e=i[n])({error:M});this.callbackMap={}},i.prototype.onMessage=function(e){var t;if(t=JSON.parse(e),"2.0"!==t.jsonrpc)throw Error("Invalid JSON RPC message. JSONRPC field is not 2.0");if(t.hasOwnProperty("method"))this.onRequest(t);else{if(!t.hasOwnProperty("error")&&!t.hasOwnProperty("result"))throw Error("Invalid JSON RPC message. None of {method, result, error} field present.");this.onResponse(t)}},i.prototype.onRequest=function(e){var t;if(!e.hasOwnProperty("params"))throw Error("Invalid JSON RPC request: missing 'params' field.");if(!e.params.hasOwnProperty("name"))throw Error("Invalid JSON RPC request: missing 'params.name' field.");return t=this.requestHandlers[e.method],t.apply(null,[e.params.name].concat(n.call(e.params.args)))},i.prototype.onResponse=function(e){var t;if("number"!=typeof e.id)throw Error("Invalid JSON RPC message. Id field is not a number.");if("function"!=typeof this.callbackMap[e.id]&&"undefined"!=typeof this.callbackMap[e.id])throw Error("Invalid JSON RPC response. Id is not recognized.");t=this.callbackMap[e.id],delete this.callbackMap[e.id],"undefined"==typeof t&&(t=function(){}),e.hasOwnProperty("error")?t({error:e.error,succeeded:!1}):e.hasOwnProperty("result")&&t({result:e.result,succeeded:!0})},i.prototype.subscribeEvent=function(e,t){var n;if(null==t||"function"!=typeof t)throw TypeError("Event subscription must have valid callback.");return n=function(n){return function(i){if(i.succeeded)return n.eventHandlers.hasOwnProperty(e)||(n.eventHandlers[e]={}),n.eventHandlers[e][t]=t;throw Error("Invalid event name: "+e)}}(this),fe.invokeRemoteMethod("_validate_global_event_name",n,[e])},i.prototype.unsubscribeEvent=function(e,t){return this.eventHandlers.hasOwnProperty(e)&&this.eventHandlers[e].hasOwnProperty(t)?delete this.eventHandlers[e][t]:void 0},i.prototype.onEventFromDesktopClient=function(e){var t,n,i,r;if(this.eventHandlers.hasOwnProperty(e)){i=this.eventHandlers[e],r=[];for(t in i)n=i[t],r.push(n.apply(null,arguments));return r}},i.prototype.getPromiseForPromisedDataFromDesktopClient=function(e){var t;return this.View.PromisedData.hasOwnProperty(e)||(this.View.PromisedData[e]={}),this.View.PromisedData[e]._promise=new Promise(function(t){return function(n,i){return t.View.PromisedData[e]._resolve=n,t.View.PromisedData[e]._reject=i}}(this)),t=function(t){return function(n){if(n.succeeded)return t._tryResolvePromise(e);throw Error("Invalid promise name: "+e)}}(this),fe.invokeRemoteMethod("_validate_promise_name",t,[e]),this.View.PromisedData[e]._promise},i.prototype.resolvePromiseFromDesktopClient=function(){var e,t;return t=arguments[0],e=2<=arguments.length?n.call(arguments,1):[],this.View.PromisedData.hasOwnProperty(t)||(this.View.PromisedData[t]={}),this.View.PromisedData[t]._data=e,this._tryResolvePromise(t)},i.prototype._tryResolvePromise=function(e){var t;return null!=this.View.PromisedData[e]._data&&null!=this.View.PromisedData[e]._resolve?(t=this.View.PromisedData[e])._resolve.apply(t,this.View.PromisedData[e]._data):void 0},i.prototype.formatFunctionId=function(e){return"com.dropbox.client.bridge-v1."+e},i.prototype.invokeRemoteMethod=function(e,t,n){var i,r,o;if(!this.hasTransport)return void("undefined"!=typeof t&&t({error:F}));if("function"!=typeof t&&"undefined"!=typeof t)throw TypeError("Remote call must have valid completion callback, if specified.");return this.hasEstablishedSession?(e=this.formatFunctionId(e),r={jsonrpc:"2.0",method:e,id:this.messageCounter},"undefined"!=typeof n&&(r.params=n),i=JSON.stringify(r),o=this.sendMessage(i),o!==U?void("undefined"!=typeof t&&t({error:o})):void(this.callbackMap[this.messageCounter++]=t)):void this.deferredInvokeQueue.push(this.invokeRemoteMethod.bind(self,e,t,n))},i.prototype.invokeRemoteMethodPromise=function(e,t){return new Promise(function(n){return function(i,r){var o;return o=function(e){return null!=e.error?r(e.error):i(e.result)},n.invokeRemoteMethod(e,o,t)}}(this))},i.prototype.isBridgeFunctionSupported=function(e){return e=this.formatFunctionId(e),new Promise(function(t){return function(n,i){return t._ensureDesktopClientInfo().then(function(){return null!=t.desktopClientInfo?n(t.desktopClientInfo.supportedFunctions.indexOf(e)>-1):i()})}}(this))},i.prototype._ensureDesktopClientInfo=function(){return new Promise(function(e){return function(t,n){return null!=e.desktopClientExportsInfo?t():e.invokeRemoteMethodPromise("_getDesktopClientInfo").then(function(n){return e.desktopClientInfo=n,e.desktopClientExportsInfo=!0,t()},function(n){return e.desktopClientExportsInfo=!1,t()})}}(this))},i}(),fe=null,te=function(e,t){return fe.subscribeEvent(e,t)},me=function(e,t){return fe.unsubscribeEvent(e,t)},w=function(e){return fe.getPromiseForPromisedDataFromDesktopClient(e)},I=function(e){return fe.isBridgeFunctionSupported(e)},b=function(){return null===fe?fe=new f:void 0},A=function(e,t){return fe.invokeRemoteMethod("openUncredentialedBrowserWithAbsoluteURL",t,[e])},k=function(e,t){return fe.invokeRemoteMethod("openUncredentialedBrowserWithDropboxURL",t,[e])},R=function(e,t){return fe.invokeRemoteMethod("openUncredentialedBrowser",t,[e])},C=function(e,t,n){return fe.invokeRemoteMethod("openCredentialedBrowser",n,[e,t])},g=function(e,t,n,i){return fe.invokeRemoteMethod("copyShmodelToClipboard",i,[e,t,n])},y=function(e){return fe.invokeRemoteMethod("getClipboardText",e)},S=function(e,t){return fe.invokeRemoteMethod("openDropboxFolderForRole",t,[e])},q=function(e,t,n){return fe.invokeRemoteMethod("reportEvent",n,[e,t])},B=function(e,t,n){return fe.invokeRemoteMethod("saveConfig",e,[t,n])},v=function(e){return fe.invokeRemoteMethod("foregroundServerView",e)},W=function(e,t){return fe.invokeRemoteMethod("setIsTopmostViewLevel",t,[e])},E=function(e){return fe.invokeRemoteMethod("LOEHideSplash",e)},T=function(e){return fe.invokeRemoteMethod("LOELaunchSignup",e)},d=function(e){return fe.invokeRemoteMethod("CDO.ShowTrayOnboarding",e)},a=function(e){return fe.invokeRemoteMethod("CDO.HideTrayOnboarding",e)},h=function(e,t){return fe.invokeRemoteMethod("CDO.SetOnboardingHeight",t,[e])},c=function(e){return fe.invokeRemoteMethod("CDO.OpenDropboxFolder",e)},u=function(e){return fe.invokeRemoteMethod("CDO.PinTrayPopup",e)},m=function(e){return fe.invokeRemoteMethod("CDO.UnpinTrayPopup",e)},l=function(e,t){return fe.invokeRemoteMethod("CDO.OpenUserFolder",t,[e])},p=function(e){return fe.invokeRemoteMethod("CDO.StartEventMonitoring",e)},_=function(e){return fe.invokeRemoteMethod("CDO.StopEventMonitoring",e)},s=function(e){return fe.invokeRemoteMethod("CDO.GetAndClearEvents",e)},o=function(e){return fe.invokeRemoteMethod("CDO.ClearShowTrayConfig",e)},o=function(e){return fe.invokeRemoteMethod("CDO.ClearShowTrayConfig",e)},ee=function(e,t,n){return null==t&&(t={}),fe.invokeRemoteMethod("SetupWizard.SetupWizardReportEvent",n,[e,t])},X=function(e){return fe.invokeRemoteMethod("SetupWizard.PollForLocationPrefChange",e)},z=function(e){return fe.invokeRemoteMethod("SetupWizard.OpenLocationPrefs",e)},Z=function(e){return fe.invokeRemoteMethod("SetupWizard.PollForSelSyncPrefChange",e)},J=function(e){return fe.invokeRemoteMethod("SetupWizard.OpenSelSyncPrefs",e)},$=function(e){return fe.invokeRemoteMethod("SetupWizard.LoginFinished",e)},K=function(e,t){return null==e&&(e={}),fe.invokeRemoteMethod("SetupWizard.LoginFinishedWithRet",t,[e])},G=function(e,t){return fe.invokeRemoteMethod("SetupWizard.SetupFinished",t,[e])},Q=function(e){return fe.invokeRemoteMethod("SetupWizard.PollForLink",e)},H=function(e){return fe.invokeRemoteMethodPromise("SetupWizard.FetchNewNonce")},Y=function(e){return fe.invokeRemoteMethod("SetupWizard.GetDropboxPath",e)},j=function(e){return fe.invokeRemoteMethod("SetupWizard.GetClientInfoAndTag",e)},re=function(e){return fe.invokeRemoteMethod("TrayPopupContent.GetTimeline",e)},oe=function(e){return fe.invokeRemoteMethod("TrayPopupContent.GetUnreadCountOtherAccount",e)},de=function(e,t){return fe.invokeRemoteMethod("TrayPopupContent.ReportRender",t,[e])},ie=function(e,t){return fe.invokeRemoteMethod("TrayPopupContent.DownloadThumbnail",t,[e])},he=function(e,t,n){return fe.invokeRemoteMethod("TrayPopupContent.PerformStickyAction",n,[e,t])},le=function(e,t,n,i){return fe.invokeRemoteMethod("TrayPopupContent.PerformNotificationAction",i,[e,t,n])},ce=function(e,t,n){return fe.invokeRemoteMethod("TrayPopupContent.PerformFileAction",n,[e,t])},ue=function(e,t,n){return fe.invokeRemoteMethod("TrayPopupContent.PerformRecallAction",n,[e,t])},se=function(e){return fe.invokeRemoteMethod("TrayPopupContent.LinkClient",e)},pe=function(e,t){return fe.invokeRemoteMethod("TrayPopupContent.ShowOtherAccountView",t,[e])},ae=function(e,t,n,i){return fe.invokeRemoteMethod("TrayPopupContent.NotificationContextMenu",i,[e,t,n])},_e=function(e,t){return fe.invokeRemoteMethod("TwoAccountPromo.exit_promo",t,[e])},N=function(e,t,n){return fe.invokeRemoteMethod("Piano.openFileOrFolder",n,[e,t])},O=function(e,t,n){return fe.invokeRemoteMethod("Piano.showFileContextMenu",n,[e,t])},r=function(e){return fe.invokeRemoteMethod("bugreporter.getReportDictionary",e)},ne=function(e,t,n){return fe.invokeRemoteMethodPromise("DEBUG.testDeferral",[e,t,n])},L=function(e){return fe.invokeRemoteMethod("ProjectDecipher.resume",e)},P=function(e){return fe.invokeRemoteMethod("PaywallDeviceLimit.unlinkOthersSuccess",e)},D=function(e){return fe.invokeRemoteMethod("PaywallDeviceLimit.openUpgradePage",e)},i=function(e,t,n,i,r,o){return fe.invokeRemoteMethod("TwoAccountSignup.authedSecondAccountLink",o,[e,t,n,i,r])},ge={ResultSuccess:U,ResultNoConnection:M,ResultInvalidRequest:x,ResultParseError:V,ResultNoTransport:F,init:b,GetNamedPromise:w,SubscribeEvent:te,UnsubscribeEvent:me,IsBridgeFunctionSupported:I,OpenUncredentialedBrowserWithAbsoluteURL:A,OpenUncredentialedBrowserWithDropboxURL:k,OpenUncredentialedBrowser:R,OpenCredentialedBrowser:C,CopyShmodelToClipboard:g,GetClipboardText:y,OpenDropboxFolderForRole:S,ReportEvent:q,SaveConfig:B,ForegroundServerView:v,SetIsTopmostViewLevel:W,LOEHideSplash:E,LOELaunchSignup:T,CDOShowTrayOnboarding:d,CDOHideTrayOnboarding:a,CDOSetOnboardingHeight:h,CDOOpenDropboxFolder:c,CDOPinTrayPopup:u,CDOUnpinTrayPopup:m,CDOOpenUserFolder:l,CDOStartEventMonitoring:p,CDOStopEventMonitoring:_,CDOGetAndClearEvents:s,CDOClearShowTrayConfig:o,SetupWizardReportEvent:ee,SetupWizardPollForLocationPrefChange:X,SetupWizardOpenLocationPrefs:z,SetupWizardPollForSelSyncPrefChange:Z,SetupWizardOpenSelSyncPrefs:J,SetupWizardLoginFinished:$,SetupWizardLoginFinishedWithRet:K,SetupWizardFinished:G,SetupWizardPollForLink:Q,SetupWizardFetchNewNonce:H,SetupWizardGetDropboxPath:Y,SetupWizardGetClientInfoAndTag:j,TrayPopupContentGetTimeline:re,TrayPopupContentGetUnreadCountOtherAccount:oe,TrayPopupContentReportRender:de,TrayPopupContentDownloadThumbnail:ie,TrayPopupContentPerformStickyAction:he,TrayPopupContentPerformNotificationAction:le,TrayPopupContentPerformFileAction:ce,TrayPopupContentPerformRecallAction:ue,TrayPopupContentLinkClient:se,TrayPopupContentShowOtherAccountView:pe,TrayPopupContentNotificationContextMenu:ae,TwoAccountPromoExitPromo:_e,BugReporterGetReportDictionary:r,PianoOpenFileOrFolder:N,PianoShowFileContextMenu:O,ProjectDecipherResume:L,PaywallDeviceLimitUnlinkOthersSuccess:P,OpenUpgradePageForPaywallDeviceLimit:D,TestDeferral:ne,AuthedSecondAccountLink:i}})}.call(this),function(){define("modules/dirty/recent_activity/actions/recent_activity_actions",["jquery","external/underscore","external/react","modules/constants/python","modules/core/exception","modules/core/browser","modules/core/i18n","modules/core/notify","modules/clean/dbmodal","modules/clean/dbmodal_loading","modules/clean/downloads","modules/clean/filepath","modules/clean/gandalf_util","modules/clean/viewer","modules/clean/recent_activity/transactions","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/react/modal","modules/clean/sharing/share_modal_util","modules/clean/unity/features","modules/constants/python","modules/core/uri","modules/clean/require_wrapper"],function(e,t,n,i,r,o,s,a,c,l,u,h,d,p,_,m,f,g,v,y,w,I,E,T,b,C,S,R){var A,k,D,P,N,O,L,x,M,F,V,U,q,assert,B,W;return M=s._,W=s.ungettext,k=c.DBModalStack,A=w.ActionTypes,x=w.TransactionPrefixes,L=E.SimpleModal,D=C.FileViewActionType,P=C.FileViewOriginType,N=C.FileViewTargetType,O=R.RequireWrapper,assert=r.assert,V=function(e,t){return O.require(["dropbox"],e,t||function(e){throw a.error(a.DEFAULT_ERROR),e})},F=function(e){return t.filter(t.pluck(e,"previewInfo"),function(e){return t.isObject(e)&&!t.isEmpty(e)&&!e.is_dir})},U=function(e,n,r){var o,s,c;return c=p.get_viewer().get_user_by_id(e),r=t.defaults({},r,{index:0,shouldFocusCommentInput:!1}),s=function(e){return e.isShown()?e.updateFiles(n):e.open(n,r.index,c,"react-file-viewer",{disableRouting:!0,oref:i.OREF_CONSTANTS.RECENTS,fileViewTarget:N.PRIVATE,fileViewOrigin:P.RECENTS,fileViewAction:D.CLICK,shouldFocusCommentInput:r.shouldFocusCommentInput,onCloseViewer:r.onCloseViewer||t.noop})},o=function(){return a.error(a.DEFAULT_ERROR)},O.require(["modules/clean/react/file_viewer/controller"],s,o)},q=function(e,n,i){var r,o,s,a,c,l;return null==i&&(i={}),a=!1,r=g.getByIds(n),s=!t.all(t.pluck(r,"isLoaded")),s&&(l=t.clone(i),c=l.onCloseViewer||t.noop,l.onCloseViewer=function(){return a=!0,c()},o=F(r),o.length&&U(e,o,l)),function(){return a}},B={loadPage:function(e){return y.loadRecentItems(e)},loadPrefetchedPage:function(e){return y.preloadRecentItems(e)},loadNextPage:function(e){var t;return t=v.cursorForUser(e),t&&y.loadRecentItems(e,t),!!t},loadAttachmentsForRecentActivities:function(){return y.loadAttachmentsForRecentActivities.apply(y,arguments)},shareFile:function(e,t,n){return null==n&&(n=null),y.ensureAttachments(e,[t],function(t){var i,r,o;return i=t[0],r=i.fqPath,o=p.get_viewer().get_user_by_id(e),T.showShareModal(o,{fqPath:r,isFolder:i.previewInfo.is_dir,origin:"RECENTS"}),n?I.logShareFile(e,r,n.totalCount,n.cellView):void 0})},shareCollection:function(e,n,i){return null==i&&(i=null),y.ensureAttachments(e,n,function(n){var r,o;return r=n.map(function(e){return{ns_id:e.nsId,ns_path:e.nsPath}}),m.createCollectionSharedLink(e,r).then(function(t){var n,i;return t.shareableItemCount<r.length&&(i=r.length-t.shareableItemCount,a.error(W("%(missing)s file can’t be shared.","%(missing)s files can’t be shared.",i).format({missing:i}))),n=S({path:"/sm/get_link_modal_content/"+t.tkey}).toString(),k.push(new l({element_id:"share-link-modal",endpoint_url:n,subject_user:e,parameters:{origin:"recents"}}))}),i?(o=t.pluck(n,"fqPath"),I.logShareCollection(e,o,i.totalCount,i.cellView)):void 0})},browseFile:function(e){return o.redirect(e)},previewFiles:function(e,n,i,r){var o;return null==i&&(i={}),o=q(e,n,i),y.ensureAttachments(e,n,function(n){var s,a,c,l,u;return c=n[0],a=F(n),a.length?(o()||U(e,a,i),r?(l=t.pluck(n,"fqPath"),u=r.totalCount,s=r.cellView,i.shouldFocusCommentInput?I.logCommentFile(e,l[i.index||0],u,s):I.logPreviewFiles(e,l,u,s)):void 0):B.browseFile(c.entityUri)})},openFile:function(e,n,i){return null==i&&(i=null),assert(b,"Unity is not supported by this browser"),y.ensureAttachments(e,[n],function(n){var o,s,c,l,u,h,d;return h=n[0],l=h.nsId,u=h.nsPath,s=h.fqPath,c=function(e){return a.error("We were unable to open this file"),r.reportException({err:new Error(e),tags:["recents"],severity:r.SEVERITY.NONCRITICAL})},b.open_file(l,u,e,t.noop,c),i?(d=i.totalCount,o=i.cellView,I.logUnityOpenFile(e,s,d,o)):void 0})},markOnboardingAsSeen:function(e){return m.markOnboardingAsSeen(e)},promptAndDeleteAttachments:function(e,n,i){var r,o,s,a;return null==i&&(i=null),s=function(){return y.ensureAttachments(e,n,function(r){var o,s,a,c;return s=t.pluck(r,"fqPath"),i&&(a=i.totalCount,o=i.cellView,I.logDeleteFiles(e,s,a,o)),c=_.createTransaction(x.DELETE_FILES,f),c.pending({attachmentIds:n}),V(function(t){var n;return n=t.FileOps,n.do_nonbrowse_delete(e,s).then(c.commit,c.rollback)},c.rollback)})},1===n.length?(a=M("Delete file?"),r=g.getById(n[0]),o=r&&r.isLoaded?M("Do you want to delete <b>%(file_name)s</b>?").format({file_name:t.escape(r.displayName)}):M("Do you want to delete this file?")):(a=M("Delete files?"),o=M("Do you want to delete <b>%(num)s files</b>?").format({num:t.escape(n.length)})),L.show({title_text:a,body_html:o,confirm_text:M("Delete"),confirm_callback:s,cancel_text:M("Cancel"),autoclose:!0})},loadAttachments:function(e,t){y.loadAttachments(e,t)},updateRecentActivities:function(){return y.updateRecentActivities.apply(y,arguments)},updateRelatedActivities:function(e){return f.dispatch({type:A.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:e})},selectAttachments:function(e,t){return f.dispatch({type:A.SELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})},deselectAttachments:function(e,t){return f.dispatch({type:A.DESELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})},downloadFiles:function(e,n,i){return y.ensureAttachments(e,n,function(n){var r,o,s;return i&&(o=t.pluck(n,"fqPath"),s=i.totalCount,r=i.cellView,I.logDownloadFile(e,o,s,r)),n.forEach(function(t){var n,i,r;return t.isDir&&null!=(null!=(n=t.previewInfo)?n.block_hash:void 0)?u.get_zip({fq_paths:[t.fqPath],subject_uid:e,block_hash:t.previewInfo.block_hash,parent_path:t.fqPath}):(r=null!=(i=t.previewInfo)?i.direct_blockserver_link:void 0)?u.get_blockserver_link({url:r}):void 0})})},openVersions:function(e,t,n){return y.ensureAttachments(e,[t],function(t){var i,r,s;return r=t[0].fqPath,V(function(t){var n,i;return n=t.FileOps,i=n.build_revisions_uri(r,e),o.redirect(i.toString())}),n?(s=n.totalCount,i=n.cellView,I.logOpenVersions(e,r,s,i)):void 0})}}})}.call(this),function(){define("modules/dirty/recent_activity/react/attachment_list_desktop_view",["jquery","external/underscore","external/react","external/react-dom","modules/core/exception","modules/core/i18n","modules/clean/components/loading_indicator","modules/clean/photos/thumbnail_url_util","modules/clean/recent_activity/react/attachment_image_view","modules/clean/recent_activity/react/attachment_image_stack_view","modules/clean/recent_activity/react/attachment_image_expanded_view","modules/clean/recent_activity/react/attachment_file_icon_view","modules/clean/recent_activity/react/attachment_list_layout","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models","modules/dirty/recent_activity/actions/recent_activity_actions","modules/clean/server_side_client_view_bridge"],function(e,t,n,i,r,o,s,a,c,l,u,h,d,p,_,m,f){var g,v,y,w,I,E,assert,T;return assert=r.assert,E=o._,T=a.thumbnailUrlForSize,I=a.ThumbnailSizeMode,w=p.SHOW_MORE_THUMBNAIL_ROW_INCREMENT,y=n.PropTypes,v=_.PropTypes,g=n.createClass({displayName:"AttachmentListDesktopView",propTypes:{attachments:y.arrayOf(v.attachment).isRequired,duplicateIds:y.arrayOf(y.number).isRequired},componentDidMount:function(){return this._updateLayoutController(),this.state.rows>1?this._loadRemainingAttachments():void 0},componentDidUpdate:function(e,t){return this._updateLayoutController(),this.state.rows>1?this._loadRemainingAttachments():void 0},getInitialState:function(){return{rows:1,errored:[],containerWidth:null,expandedAttachments:{}}},_updateLayoutController:function(){var t,n,r,o;return t=e(i.findDOMNode(this.refs.attachmentsList)),n=t.innerWidth(),n!==this.state.containerWidth?(r=Math.abs(parseFloat(t.css("margin-left")))||0,o=Math.floor(n/2)-r,this._layoutController=d.create(n,o,r),this.setState({containerWidth:n})):void 0},_openAttachment:function(e){var n;return n=t.findWhere(this.props.attachments,{id:e}),f.PianoOpenFileOrFolder(n.nsId,n.nsPath)},_openContextMenu:function(e){var n;return n=t.findWhere(this.props.attachments,{id:e}),f.PianoShowFileContextMenu(n.nsId,n.nsPath)},_expandStack:function(e){var n,i,r,o,s,a,c,l,u;for(n=this._dedupeMetadata(),a=t.find(n,function(t){return t.attachment.id===e}),i=t.clone(this.state.expandedAttachments),o=this.props.attachments.indexOf(a.attachment),u=a.stackLength,r=s=c=o,l=o+u;l>=c?l>s:s>l;r=l>=c?++s:--s)i[this.props.attachments[r].id]=e;return this.setState({expandedAttachments:i})},_collapseStack:function(e){var n,i,r,o,s,a,c,l,u,h;for(r=this.state.expandedAttachments[e],n=this._dedupeMetadata(),c=t.find(n,function(e){return e.attachment.id===r}),i=t.clone(this.state.expandedAttachments),s=this.props.attachments.indexOf(c.attachment),h=c.stackLength,o=a=l=s,u=s+h;u>=l?u>a:a>u;o=u>=l?++a:--a)delete i[this.props.attachments[o].id];return this.setState({expandedAttachments:i})},_handleImageLoadError:function(e){var t;return t=this.state.errored.slice(),t.push(e),this.setState({errored:t})},_revealNextGroup:function(){return this.setState({rows:this.state.rows+w})},_loadRemainingAttachments:function(){var e,n;return n=this.props.attachments[0].viewingUserId,e=this.props.attachments.filter(t.negate(t.property("isLoaded"))).map(t.property("id")),
e.length?m.loadAttachments(n,e):void 0},_renderFileIconView:function(e,t,i,r){var o;return o=e.attachment,n.createElement(h,{key:"attachment-"+e.id,id:e.id,file:{icon:o.previewInfo.icon,displayName:o.displayName,entityUri:o.entityUri},overlayText:t,handleClick:i,handleContextMenu:r,showCheckmark:!1})},_renderStackedImageView:function(e,t,i){var r,o;return r=e.attachment,o=this._propsForImageView(e,i),o.key="attachment-stacked-"+e.id,o.handleClick=this._expandStack,o.handleCornerClick=this._expandStack,o.stackLength=t,n.createElement(l,n.__spread({},o))},_renderExpandedImageView:function(e,t,i){var r,o;return r=e.attachment,o=this._propsForImageView(e,i),o.showCheckmark=!1,o.handleCornerClick=this._collapseStack,n.createElement(u,n.__spread({},o))},_renderImageView:function(e,t,i,r){var o,s;return o=e.attachment,s=this._propsForImageView(e,i),s.key="attachment-expanded-"+e.id,s.overlayText=t,s.showCheckmark=!1,s.handleContextMenu=r,n.createElement(c,n.__spread({},s))},_propsForImageView:function(e,t){var n,i,r;return n=e.attachment,i="video"===(null!=(r=n.previewInfo)?r.preview_type:void 0),{id:e.id,image:{thumbnailUrl:e.scaledThumbnailUrl,entityUri:n.entityUri,displayName:n.displayName,width:e.width,height:e.height},badgeType:i?c.BadgeType.VIDEO:void 0,handleClick:t,handleLoadError:this._handleImageLoadError}},_dedupeMetadata:function(){var e,t,n,i,r,o,s,a,c,l,u,h,d,p,_,m,f,g,v;if(n=[],i={},t={},v={},this.props.duplicateIds)for(_=this.props.attachments,o=u=0,d=_.length;d>u;o=++u)e=_[o],r=this.props.duplicateIds[o],r in i||(i[r]=[],v[e.id]=e),i[r].push(e),t[e.id]=i[r];for(m=this.props.attachments,h=0,p=m.length;p>h;h++)e=m[h],a=e.id in this.state.expandedAttachments,g=null!=(f=t[e.id])?f.length:void 0,c=e.id in v,l=g>1&&c,s=g>1&&!c,s&&!a||n.push({attachment:e,stackLength:g,isParentOfStack:c,isStacked:l,isExpanded:a});return n},_isLoading:function(){return this.state.rows>1&&!t.all(this.props.attachments,t.property("isLoaded"))},_renderAttachmentItems:function(){var e,i,r,o,s,a,l,u,d,p,_,m,f,g,v,y,w,I,T,b,C,S,R;return this.state.containerWidth?(r=this._dedupeMetadata(),i=t.pluck(r,"attachment"),b=this._isLoading()?1:this.state.rows,o=this._layoutController.generate(i,b,this.state.errored),e=t.flatten(o),s=this._openAttachment,a=this._openContextMenu,R=e.length,S=i.length,T=S-R+1,_=!this._isLoading()&&S>R,g=function(){var t,i,o;for(o=[],l=t=0,i=e.length;i>t;l=++t)switch(y=e[l],p=l===e.length-1,f=r[l].isStacked,m=r[l].isParentOfStack,d=r[l].isExpanded,C=r[l].stackLength,p&&_&&(s=this._revealNextGroup,a=null,w=E("+%(count)s").format({count:T})),v="attachment-item-"+y.attachment.id,I={key:v},y.view){case h:o.push(n.createElement("li",n.__spread({},I),this._renderFileIconView(y,w,s,a)));break;case c:u=_&&p,C>1&&!u?m&&d?o.push(n.createElement("li",n.__spread({},I),this._renderImageView(y,w,s,a))):f&&!d?o.push(n.createElement("li",n.__spread({},I),this._renderStackedImageView(y,C,s))):d?o.push(n.createElement("li",n.__spread({},I),this._renderExpandedImageView(y,w,s))):o.push(void 0):o.push(n.createElement("li",n.__spread({},I),this._renderImageView(y,w,s,a)));break;default:y.view?o.push(assert(!1,y.view.displayName+" is not supported by AttachmentListView")):o.push(void 0)}return o}.call(this)):[]},_renderLoadingView:function(){var e;return e=n.createElement(s,{style:s.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}),n.createElement("div",{ref:"loading",className:"attachment-loading"},e)},render:function(){var e,t;return e=this._renderAttachmentItems(),t=null,this._isLoading()&&(t=this._renderLoadingView()),n.createElement("div",{className:"recents-item__attachments"},n.createElement("ul",{ref:"attachmentsList",className:"attachment-list"},e),t)}})})}.call(this),function(){define("modules/dirty/recent_activity/react/attachment_list_view",["jquery","external/underscore","external/react","external/react-dom","modules/core/exception","modules/core/i18n","modules/clean/components/loading_indicator","modules/clean/photos/thumbnail_url_util","modules/clean/recent_activity/react/attachment_image_view","modules/clean/recent_activity/react/attachment_image_stack_view","modules/clean/recent_activity/react/attachment_image_expanded_view","modules/clean/recent_activity/react/attachment_file_icon_view","modules/clean/recent_activity/react/attachment_list_layout","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/recent_activity_logger_utils","modules/dirty/recent_activity/actions/recent_activity_actions"],function(e,t,n,i,r,o,s,a,c,l,u,h,d,p,_,m,f){var g,v,y,w,I,E,assert,T,b;return assert=r.assert,E=o._,b=a.thumbnailUrlForSize,I=a.ThumbnailSizeMode,w=p.SHOW_MORE_THUMBNAIL_ROW_INCREMENT,T=n.DOM,y=n.PropTypes,v=_.PropTypes,g=n.createClass({displayName:"AttachmentListView",propTypes:{attachments:y.arrayOf(v.attachment).isRequired,duplicateIds:n.PropTypes.arrayOf(n.PropTypes.number).isRequired,selectedAttachmentIds:y.array,handleToggleSelect:y.func},componentDidMount:function(){return this._updateLayoutController(),this.state.rows>1?this._loadRemainingAttachments():void 0},componentWillReceiveProps:function(e){return this._isAllSelected(e)?this.setState({rows:1/0}):void 0},componentDidUpdate:function(e,t){return this._updateLayoutController(),this.state.rows>1?this._loadRemainingAttachments():void 0},getInitialState:function(){return{rows:this._isAllSelected(this.props)?1/0:1,errored:[],containerWidth:null,expandedAttachments:{}}},getDefaultProps:function(){return{handleToggleSelect:function(){},selectedAttachmentIds:[]}},_isAllSelected:function(e){return t.size(e.selectedAttachmentIds)===e.attachments.length},_updateLayoutController:function(){var t,n,r,o;return t=e(i.findDOMNode(this.refs.attachmentsList)),n=t.innerWidth(),n!==this.state.containerWidth?(r=Math.abs(parseFloat(t.css("margin-left")))||0,o=Math.floor(n/2)-r,this._layoutController=d.create(n,o,r),this.setState({containerWidth:n})):void 0},_previewAttachment:function(e){var n,i,r,o;return n=t.findWhere(this.props.attachments,{id:e}),o=n.viewingUserId,i=t.pluck(this.props.attachments,"id"),r={totalCount:this.props.attachments.length,cellView:this},f.previewFiles(o,i,{index:this.props.attachments.indexOf(n)},r)},_expandStack:function(e){var n,i,r,o,s,a,c,l,u;for(n=this._dedupeMetadata(),a=t.find(n,function(t){return t.attachment.id===e}),i=t.clone(this.state.expandedAttachments),o=this.props.attachments.indexOf(a.attachment),u=a.stackLength,r=s=c=o,l=o+u;l>=c?l>s:s>l;r=l>=c?++s:--s)i[this.props.attachments[r].id]=e;return this.setState({expandedAttachments:i})},_collapseStack:function(e){var n,i,r,o,s,a,c,l,u,h;for(r=this.state.expandedAttachments[e],n=this._dedupeMetadata(),c=t.find(n,function(e){return e.attachment.id===r}),i=t.clone(this.state.expandedAttachments),s=this.props.attachments.indexOf(c.attachment),h=c.stackLength,o=a=l=s,u=s+h;u>=l?u>a:a>u;o=u>=l?++a:--a)delete i[this.props.attachments[o].id];return this.setState({expandedAttachments:i})},_handleImageToggleSelect:function(e,n){var i;return i=t.findWhere(this.props.attachments,{id:e}),this.props.handleToggleSelect(i,n)},_handleImageLoadError:function(e){var t;return t=this.state.errored.slice(),t.push(e),this.setState({errored:t})},_revealNextGroup:function(){return this.setState({rows:this.state.rows+w})},_loadRemainingAttachments:function(){var e,n;return n=this.props.attachments[0].viewingUserId,e=this.props.attachments.filter(t.negate(t.property("isLoaded"))).map(t.property("id")),e.length?f.loadAttachments(n,e):void 0},_renderFileIconView:function(e,t,i){var r;return r=e.attachment,n.createElement(h,{key:"attachment-"+e.id,id:e.id,file:{icon:r.previewInfo.icon,displayName:r.displayName,entityUri:r.entityUri},overlayText:t,handleClick:i,showCheckmark:this.props.attachments.length>1&&!t,handleToggleSelect:this._handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.indexOf(r.id)>-1})},_renderStackedImageView:function(e,t,i){var r,o;return r=e.attachment,o=this._propsForImageView(e,i),o.key="attachment-stacked-"+e.id,o.handleClick=this._expandStack,o.handleCornerClick=this._expandStack,o.stackLength=t,n.createElement(l,o)},_renderExpandedImageView:function(e,t,i){var r,o;return r=e.attachment,o=this._propsForImageView(e,i),o.showCheckmark=this.props.attachments.length>1,o.handleCornerClick=this._collapseStack,n.createElement(u,o)},_renderImageView:function(e,t,i){var r,o;return r=e.attachment,o=this._propsForImageView(e,i),o.key="attachment-expanded-"+e.id,o.overlayText=t,o.showCheckmark=this.props.attachments.length>1&&!t,n.createElement(c,o)},_propsForImageView:function(e,t){var n,i,r;return n=e.attachment,i="video"===(null!=(r=n.previewInfo)?r.preview_type:void 0),{id:e.id,image:{thumbnailUrl:e.scaledThumbnailUrl,entityUri:n.entityUri,displayName:n.displayName,width:e.width,height:e.height},badgeType:i?c.BadgeType.VIDEO:void 0,handleClick:t,handleLoadError:this._handleImageLoadError,handleToggleSelect:this._handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.indexOf(n.id)>-1}},_dedupeMetadata:function(){var e,t,n,i,r,o,s,a,c,l,u,h,d,p,_,m,f,g,v;if(n=[],i={},t={},v={},this.props.duplicateIds)for(_=this.props.attachments,o=u=0,d=_.length;d>u;o=++u)e=_[o],r=this.props.duplicateIds[o],r in i||(i[r]=[],v[e.id]=e),i[r].push(e),t[e.id]=i[r];for(m=this.props.attachments,h=0,p=m.length;p>h;h++)e=m[h],a=e.id in this.state.expandedAttachments,g=null!=(f=t[e.id])?f.length:void 0,c=e.id in v,l=g>1&&c,s=g>1&&!c,s&&!a||n.push({attachment:e,stackLength:g,isParentOfStack:c,isStacked:l,isExpanded:a});return n},_isLoading:function(){return this.state.rows>1&&!t.all(this.props.attachments,t.property("isLoaded"))},_renderAttachmentItems:function(){var e,n,i,r,o,s,a,l,u,d,p,_,m,f,g,v,y,w,I,b,C,S;return this.state.containerWidth?(i=this._dedupeMetadata(),n=t.pluck(i,"attachment"),I=this._isLoading()?1:this.state.rows,r=this._layoutController.generate(n,I,this.state.errored),e=t.flatten(r),o=this._previewAttachment,S=e.length,C=n.length,w=C-S+1,d=!this._isLoading()&&C>S,m=function(){var t,n,r;for(r=[],s=t=0,n=e.length;n>t;s=++t)switch(g=e[s],u=s===e.length-1,_=i[s].isStacked,p=i[s].isParentOfStack,l=i[s].isExpanded,b=i[s].stackLength,u&&d&&(o=this._revealNextGroup,v=E("+%(count)s").format({count:w})),f="attachment-item-"+g.attachment.id,y={key:f},g.view){case h:r.push(T.li(y,this._renderFileIconView(g,v,o)));break;case c:a=d&&u,b>1&&!a?p&&l?r.push(T.li(y,this._renderImageView(g,v,o))):_&&!l?r.push(T.li(y,this._renderStackedImageView(g,b,o))):l?r.push(T.li(y,this._renderExpandedImageView(g,v,o))):r.push(void 0):r.push(T.li(y,this._renderImageView(g,v,o)));break;default:g.view?r.push(assert(!1,g.view.displayName+" is not supported by AttachmentListView")):r.push(void 0)}return r}.call(this)):[]},_renderLoadingView:function(){var e;return e=n.createElement(s,{style:s.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}),T.div({ref:"loading",className:"attachment-loading"},e)},render:function(){var e,t;return e=this._renderAttachmentItems(),t=null,this._isLoading()&&(t=this._renderLoadingView()),T.div({className:"recents-item__attachments"},T.ul({ref:"attachmentsList",className:"attachment-list"},e),t)}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/recent_activity/react/comment_attachment_view",["external/underscore","external/classnames","external/react","modules/core/user_i18n","modules/clean/em_string","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/viewer_avatar","modules/clean/react/file_path_breadcrumb","modules/clean/react/helpers","modules/clean/comments/comment_dom","modules/clean/recent_activity/recent_activity_view_models","modules/clean/viewer"],function(t,n,i,r,o,s,a,c,l,u,h,d,p){var _,m,f,g;return f=u.compareStateAndProps,g=i.DOM,m=d.PropTypes,_=i.createClass({displayName:"CommentAttachmentView",propTypes:{attachment:m.attachment.isRequired,handlePreview:i.PropTypes.func},getDefaultProps:function(){return{handlePreview:t.noop}},shouldComponentUpdate:f,_handleClick:function(){return this.props.handlePreview()},_renderCommentText:function(){var e;return e=h.convertRawCommentTextToReactDom(this.props.attachment.commentRawText,!1),g.div({className:"comment-attachment-item__comment"},g.div({className:"comment-bubble"},e))},_renderAvatar:function(){var t,n,o;return n={dimension:24,defaultAvatar:i.createElement(a,{key:"commenter-"+this.props.attachment.commenterId,dimension:24,shape:"CIRCLE",initials:r.getInitials(this.props.attachment.commenterDisplayName)})},""!==this.props.attachment.commenterPhotoUrl&&(n.photoUrl=this.props.attachment.commenterPhotoUrl),o=this.props.attachment.commenterId,t=e.call(p.get_viewer().get_user_ids(!0),o)>=0?i.createElement(c,n):i.createElement(s,n),g.div({className:"comment-attachment-item__avatar"},t)},render:function(){var e,t;return e=this._renderAvatar(),t=this._renderCommentText(),g.div({className:"comment-attachment-item",onClick:this._handleClick},e,t)}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/recent_activity/react/doc_attachment_desktop_view",["external/underscore","external/react","modules/core/i18n","modules/core/exception","modules/clean/em_string","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/dirty/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/recent_activity_constants","modules/clean/server_side_client_view_bridge"],function(t,n,i,r,o,s,a,c,l,u,h){var d,p,_,m,assert;return m=i._,assert=r.assert,_=u.RECENT_EVENT_TYPES,p=l.PropTypes,d=n.createClass({displayName:"DocAttachmentDesktopView",propTypes:{recentItem:p.recentItem,attachment:p.attachment},_handleShare:function(e){var t;return e.preventDefault(),e.stopPropagation(),t=this.props.attachment,h.CopyShmodelToClipboard(t.nsId,t.nsPath,"piano")},_isSharedLink:function(){var t,n;return n=[_.FILE_SHARED_ADD,_.FILE_SHARED_VIEW],t=this.props.recentItem.type,e.call(n,t)>=0},_openAttachment:function(e){var t;return e.preventDefault(),e.stopPropagation(),t=this.props.attachment,h.PianoOpenFileOrFolder(t.nsId,t.nsPath)},_openContextMenu:function(e,t){var n;return e.preventDefault(),e.stopPropagation(),n=this.props.attachment,h.PianoShowFileContextMenu(n.nsId,n.nsPath)},_renderShareButton:function(){return n.createElement("a",{ref:"copyLink",className:"recents-item__share-link button-secondary",href:"#share",onClick:this._handleShare},m("Copy link"))},_renderHeading:function(){var e,t,i,r,a;return i=null!=(null!=(r=this.props.attachment.previewInfo)?r.icon:void 0)?this.props.attachment.previewInfo.icon:"page_white_text",this._isSharedLink()?e=[]:(a=n.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this._renderShareButton()),e=[a]),t=n.createElement(s,{ref:"recentsItemHeader",header:{heading:o.em_snippet(this.props.attachment.displayName,35),subheading:null,icon:i,thumbnailUrl:this.props.attachment.thumbnailUrl},tooltipShown:!1},e)},render:function(){var e;return e=this._renderHeading(),n.createElement("li",{className:"doc-attachment-item",onClick:this._openAttachment,onContextMenu:this._openContextMenu},e)}})})}.call(this),function(){define("modules/dirty/recent_activity/react/doc_attachment_list_desktop_view",["jquery","external/underscore","external/react","external/classnames","modules/core/i18n","modules/clean/em_string","modules/clean/components/loading_indicator","modules/dirty/recent_activity/actions/recent_activity_actions","modules/dirty/recent_activity/react/doc_attachment_desktop_view","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models"],function(e,t,n,i,r,o,s,a,c,l,u){var h,d,p,_,m,f;return f=r._,d=l.MAX_INITIAL_DOC_ATTACHMENTS,m=l.SHOW_MORE_DOC_ATTACHMENT_INCREMENT,_=n.PropTypes,p=u.PropTypes,h=n.createClass({displayName:"DocAttachmentListDesktopView",propTypes:{recentItem:p.recentItem,attachments:_.arrayOf(p.attachment),isCollapsed:_.bool},getInitialState:function(){return{numberOfRows:d}},componentDidMount:function(){return this.state.numberOfRows>d?this._loadRemainingAttachments():void 0},componentDidUpdate:function(e,t){return this.state.numberOfRows>d?this._loadRemainingAttachments():void 0},_loadRemainingAttachments:function(){var e,n;if(this.props.attachments.length)return n=this.props.attachments[0].viewingUserId,e=this.props.attachments.filter(t.negate(t.property("isLoaded"))).map(t.property("id")),e.length?a.loadAttachments(n,e):void 0},_revealNextGroup:function(e){return e.preventDefault(),this.setState({numberOfRows:this.state.numberOfRows+m})},_renderFileView:function(e,t){return n.createElement(c,{key:"attachment-"+e.id,attachment:e,recentItem:this.props.recentItem})},_renderLoadMoreView:function(e){var t;return t=f("Show %(num)s more").format({num:e}),n.createElement("button",{ref:"loadMore",key:"attachment-load-more",className:"button-as-link",onClick:this._revealNextGroup},t)},_renderLoadingView:function(){return n.createElement("li",{ref:"loading",key:"attachment-loading",className:"attachment-loading"},n.createElement(s,{style:s.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},_renderFooter:function(e){var t,i;return i=Math.min(e,m),t=n.createElement("div",{className:"doc-attachment-list__footer--cell"},this._renderLoadMoreView(i)),n.createElement("li",{key:"attachment-footer",className:"doc-attachment-list__footer"},t)},_renderAttachmentItems:function(){var e,t,n,i;return t=this.props.attachments.slice(0,this.state.numberOfRows),n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],e.isLoaded&&r.push(this._renderFileView(e));return r}.call(this),i=this.props.attachments.length-n.length,t.length>n.length?n.push(this._renderLoadingView()):i>0&&n.push(this._renderFooter(i)),n},render:function(){var e,t,r;return t=this._renderAttachmentItems(),r=null,this.props.attachments&&0!==this.props.attachments.length&&(r=n.createElement("div",{className:"doc-attachment-list__spacer"})),e={"recents-item__doc-attachments":!0,"recents-item__doc-attachments--collapsed":this.props.isCollapsed},n.createElement("div",{className:i(e)},r,n.createElement("ul",{ref:"attachmentsList",className:"doc-attachment-list"},t))}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/recent_activity/react/doc_attachment_list_view",["jquery","external/underscore","external/react","external/classnames","modules/core/exception","modules/core/i18n","modules/clean/em_string","modules/clean/components/loading_indicator","modules/dirty/recent_activity/actions/recent_activity_actions","modules/dirty/recent_activity/react/doc_attachment_view","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models"],function(t,n,i,r,o,s,a,c,l,u,h,d){var p,_,m,f,g,v,assert,y;return assert=o.assert,v=s._,_=h.MAX_INITIAL_DOC_ATTACHMENTS,g=h.SHOW_MORE_DOC_ATTACHMENT_INCREMENT,y=i.DOM,f=i.PropTypes,m=d.PropTypes,p=i.createClass({displayName:"DocAttachmentListView",propTypes:{recentItem:m.recentItem,attachments:f.arrayOf(m.attachment),isCollapsed:f.bool,isMaestroDesign:f.bool},getDefaultProps:function(){return{isMaestroDesign:!1}},getInitialState:function(){return{numberOfRows:_}},componentDidMount:function(){return this.state.numberOfRows>_?this._loadRemainingAttachments():void 0},componentDidUpdate:function(e,t){return this.state.numberOfRows>_?this._loadRemainingAttachments():void 0},componentWillReceiveProps:function(t){var i,r,o,s;return s=this.props.attachments.slice(0,this.state.numberOfRows).filter(n.property("isLoaded")).map(n.property("id")),o=s.length,r=t.attachments.map(n.property("id")).filter(function(t){return e.call(s,t)>=0}).length,o>r?(i=this.state.numberOfRows+r-o,assert(i>=0,"number of rows removed cannot be greater than the total number of rows"),this.setState({numberOfRows:this.state.numberOfRows+r-o})):void 0},_loadRemainingAttachments:function(){var e,t;if(this.props.attachments.length)return t=this.props.attachments[0].viewingUserId,e=this.props.attachments.filter(n.negate(n.property("isLoaded"))).map(n.property("id")),e.length?l.loadAttachments(t,e):void 0},_shouldShowSubheading:function(){return!1},_revealNextGroup:function(e){return e.preventDefault(),this.setState({numberOfRows:this.state.numberOfRows+g})},_renderFileView:function(e,t){return i.createElement(u,{key:"attachment-"+e.id,attachment:e,recentItem:this.props.recentItem,showSubheading:this._shouldShowSubheading(),isMaestroDesign:this.props.isMaestroDesign})},_renderLoadMoreView:function(e){var t;return t=v("Show %(num)s more").format({num:e}),y.button({ref:"loadMore",key:"attachment-load-more",className:"button-as-link",onClick:this._revealNextGroup},t)},_renderLoadingView:function(){var e;return e=i.createElement(c,{style:c.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}),y.li({ref:"loading",key:"attachment-loading",className:"attachment-loading"},e)},_renderFooter:function(e){var t,n;return n=Math.min(e,g),t=y.div({className:"doc-attachment-list__footer--cell"},this._renderLoadMoreView(n)),y.li({key:"attachment-footer",className:"doc-attachment-list__footer"},t)},_renderAttachmentItems:function(){var e,t,i,r;return e=this.props.attachments.slice(0,this.state.numberOfRows),t=e.filter(n.property("isLoaded")).map(this._renderFileView),r=this.props.attachments.length-t.length,i=e.filter(n.negate(n.property("isLoaded"))),i.length>0?t.push(this._renderLoadingView()):r>0&&t.push(this._renderFooter(r)),t},render:function(){var e,t,n;return t=this._renderAttachmentItems(),n=null,this.props.attachments&&0!==this.props.attachments.length&&(n=y.div({className:"doc-attachment-list__spacer"})),e={"recents-item__doc-attachments":!0,"recents-item__doc-attachments--collapsed":this.props.isCollapsed},y.div({className:r(e)},n,y.ul({ref:"attachmentsList",className:"doc-attachment-list"},t))}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},t=[].slice;define("modules/dirty/recent_activity/react/doc_attachment_view",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/core/exception","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/recent_activity/react/recent_activity_item_actions_view","modules/dirty/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/recent_activity_view_helper","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/recent_activity_constants"],function(n,i,r,o,s,a,c,l,u,h,d,p,_){var m,f,g,v,assert,y,w;return v=o._,assert=s.assert,w=d.ensureUserIntentToClick,g=_.RECENT_EVENT_TYPES,y=r.DOM,f=p.PropTypes,m=r.createClass({displayName:"DocAttachmentView",propTypes:{recentItem:f.recentItem,attachment:f.attachment,showSubheading:r.PropTypes.bool,isMaestroDesign:r.PropTypes.bool},getDefaultProps:function(){return{showSubheading:!1,isMaestroDesign:!1}},getInitialState:function(){return{tooltipShown:!1}},_handleShare:function(){var e;return e=this.props.attachment.viewingUserId,h.shareFile(e,this.props.attachment.id,{totalCount:this.props.recentItem.attachmentIds.length,cellView:this})},_handleOpen:function(){var e;return assert(this.props.attachment.canOpen,"This item does not support opening"),e=this.props.recentItem.viewingUserId,h.openFile(e,this.props.attachment.id,{totalCount:this.props.recentItem.attachmentIds.length,cellView:this})},_handleDelete:function(){return h.promptAndDeleteAttachments(this.props.attachment.viewingUserId,[this.props.attachment.id],{totalCount:this.props.recentItem.attachmentIds.length,cellView:this})},_isSharedLink:function(){var t,n;return n=[g.FILE_SHARED_ADD,g.FILE_SHARED_VIEW],t=this.props.recentItem.type,e.call(n,t)>=0},_previewOrOpenFiles:function(e){var t,n,i,r;return this._isSharedLink()?void h.browseFile(this.props.attachment.entityUri):(i=this.props.attachment,t=i.id,r=i.viewingUserId,n={totalCount:this.props.recentItem.attachmentIds.length,cellView:this},h.previewFiles(r,[t],{shouldFocusCommentInput:e},n))},_handleDownload:function(){var e;return e=this.props.recentItem.viewingUserId,h.downloadFiles(e,[this.props.attachment.id],{totalCount:this.props.recentItem.attachmentIds.length,cellView:this})},_handleComment:function(){return this._previewOrOpenFiles(!0)},_handleVersions:function(){var e;return e=this.props.recentItem.viewingUserId,h.openVersions(e,this.props.attachment.id,{totalCount:this.props.recentItem.attachmentIds.length,cellView:this})},_onBlur:function(e){return this.setState({isFocused:!1})},_onFocus:function(e){return this.setState({isFocused:!0})},_onPreview:function(e){return e.preventDefault(),this._previewOrOpenFiles(!1)},_onShowTooltip:function(){return this.setState({tooltipShown:!0})},_onHideTooltip:function(){return this.setState({tooltipShown:!1})},_subheading:function(){return r.createElement(c,{handlePathClick:this.props.handlePathClick,paths:this.props.recentItem.paths,viewingUserId:this.props.recentItem.viewingUserId})},_renderShareButton:function(){return y.a({ref:"shareLink",className:"recents-item__share-link button-secondary",href:"#share",onClick:this._handleShare},v("Share"))},_renderActions:function(){return this._isSharedLink()?r.createElement(u,{ref:"recentsItemActionsView",handleOpen:this.props.attachment.canOpen?this._handleOpen:null,onShowTooltip:this._onShowTooltip,onHideTooltip:this._onHideTooltip,type:this.props.recentItem.type,isMaestroDesign:this.props.isMaestroDesign}):r.createElement(u,{ref:"recentsItemActionsView",handleOpen:this.props.attachment.canOpen?this._handleOpen:null,handleDelete:this.props.attachment.isReadOnly?null:this._handleDelete,handleDownload:this._handleDownload,handleComment:this.props.attachment.isDir?null:this._handleComment,handleVersions:this.props.attachment.isDir?null:this._handleVersions,onShowTooltip:this._onShowTooltip,onHideTooltip:this._onHideTooltip,isMaestroDesign:this.props.isMaestroDesign})},_renderHeading:function(){var e,n,i,o,s,c;return o=null!=(null!=(s=this.props.attachment.previewInfo)?s.icon:void 0)?this.props.attachment.previewInfo.icon:"page_white_text",e=this._renderActions(),this._isSharedLink()?n=[e]:(c=y.div({className:"recents-item__sharing recents-item__action-button"},this._renderShareButton()),n=[c,e]),i=r.createElement.apply(r,[l,{ref:"recentsItemHeader",header:{heading:a.em_snippet(this.props.attachment.displayName,35),subheading:this.props.showSubheading?this._subheading():void 0,icon:o,thumbnailUrl:this.props.attachment.thumbnailUrl},tooltipShown:this.state.tooltipShown,handleClick:this._onPreview}].concat(t.call(n)))},render:function(){var e;return e=this._renderHeading(),y.li({className:i({"doc-attachment-item":!0,"doc-attachment-item--focused-in":this.state.isFocused}),onClick:w(this._onPreview),onBlur:this._onBlur,onFocus:this._onFocus},e)}})})}.call(this),function(){define("modules/dirty/recent_activity/react/recent_activity_container",["jquery","external/underscore","external/react","modules/constants/viewer","modules/clean/page_role_observer","modules/clean/react/app_actions_view","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/uploader","modules/clean/viewer","modules/clean/web_timing_logger","modules/core/i18n","modules/dirty/recent_activity/actions/recent_activity_actions","modules/dirty/recent_activity/react/recent_activity_view","modules/clean/sharing/wizard/wizard_modals","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/react/maestro/secondary_sidebar"],function(e,t,n,i,r,o,s,a,c,l,u,h,d,p,_,m,f,g){var v,y,w,I,E,T,b,C,S,R,A;return E=i.ROLE_WORK,I=i.ROLE_PERSONAL,b=s.UploaderActions,v=a.FileUploader,C=u._,A=p.showShareAFolderWizardModal,w=m.RECENT_EVENT_FILTER_TYPE,y=g.MaestroSecondarySidebar,S=n.DOM,R=function(n){var i,r;return r=0,i=function(){var t;return t=e(window).scrollTop()/(document.documentElement.scrollHeight-window.innerHeight),t>.8&&t>r&&n(),r=t},window.addEventListener("scroll",t.throttle(i,150,{trailing:!1}),!1)},T=n.createClass({displayName:"RecentActivityContainer",propTypes:{initialRole:n.PropTypes.oneOf(E,I).isRequired,seenOnboarding:n.PropTypes.bool.isRequired,showNewFeatureMessage:n.PropTypes.bool.isRequired,isDesktop:n.PropTypes.bool,localDatetime:n.PropTypes.string,isMaestroDesign:n.PropTypes.bool},getDefaultProps:function(){return{isDesktop:!1,isMaestroDesign:!1}},getInitialState:function(){return{items:[],role:this.props.initialRole,filter:w.ALL,isPending:!1,seenOnboarding:this.props.seenOnboarding}},componentWillMount:function(){var e;return b.setUser({user:this._actorUser()}),this._removeStoreListener=_.addListener(this._onUpdateFromStore),this.props.isMaestroDesign||h.loadPrefetchedPage(this._viewingUserId(this.state.role)),e=this._itemsFromStore(this.state.role,this.state.filter),_.didReceiveRecentActivities()?this.setState({isPending:!1,items:e}):this.setState({isPending:0===e.length,items:e}),r.addListener(this._onRoleUpdate),this._logTimeToInteractive=t.once(l.mark_time_to_interactive.bind(l)),this.props.isDesktop?setTimeout(this._setLoadNewItemsTimer,1e4):void 0},componentDidMount:function(){return R(t.throttle(this._onShouldLoadMore,2e3,{trailing:!1})),!this.state.items.length&&_.didReceiveRecentActivities()?(this._logTimeToInteractive(),this.setState({isPending:!1})):void 0},_loadNewItems:function(){return h.loadPage(this._viewingUserId(this.state.role))},_setLoadNewItemsTimer:function(){return this.isMounted()?this._timer=setInterval(this._loadNewItems,1e4):void 0},_clearLoadNewItemsTimer:function(){return this._timer?(clearInterval(this._timer),this._timer=null):void 0},componentDidUpdate:function(){return this.state.items.length?this._logTimeToInteractive():void 0},componentWillUnmount:function(){return this._clearLoadNewItemsTimer(),this._removeStoreListener(),r.removeListener(this._onRoleUpdate)},_onShouldLoadMore:function(){var e;return!this.state.isPending&&(e=h.loadNextPage(this._viewingUserId(this.state.role)))?this.setState({isPending:!0}):void 0},_onUpdateFromStore:function(){var e,t;return t=this._itemsFromStore(this.state.role,this.state.filter),e=!_.isLoadedForUser(this._viewingUserId(this.state.role)),!this.state.items.length&&_.didReceiveRecentActivities()&&(e=!1),this.setState({isPending:e,items:t})},_onOnboardingConfirm:function(){return this.setState({seenOnboarding:!0}),h.markOnboardingAsSeen(this._viewingUserId(this.state.role))},_onRoleUpdate:function(e){var t,n;if(e!==this.state.role)return n=this._viewingUserId(e),t=this._itemsFromStore(e,this.state.filter),h.loadPage(n),this.setState({role:e,items:t,filter:w.ALL,isPending:0===t.length})},_itemsFromStore:function(e,t){return _.filterItemsForUser(this._viewingUserId(e),t)},_actorUser:function(){return c.get_viewer().get_user_by_role(this.state.role)},_viewingUserId:function(e){var t;return t=c.get_viewer(),t.get_user_by_role(e).id},_renderFileUploader:function(){return n.createElement(v,{ref:"fileUploader",key:1})},_handleUploadFilesClick:function(e){return v.showModal()},_renderAppActionsMenu:function(){return n.createElement(o,{primaryMenuItem:{displayName:C("Upload files"),iconName:"upload_16",handleClick:this._handleUploadFilesClick},secondaryMenuItems:[{displayName:C("New shared folder"),
iconName:"rainbow_16",handleClick:function(e){return function(){return A(e._actorUser())}}(this)}]})},render:function(){return S.div({},n.createElement(d,{items:this.state.items,filter:this.state.filter,isPending:this.state.isPending,seenOnboarding:this.state.seenOnboarding,onOnboardingConfirm:this._onOnboardingConfirm,showNewFeatureMessage:this.props.showNewFeatureMessage,userId:this._viewingUserId(this.state.role),localDatetime:this.props.localDatetime,isMaestroDesign:this.props.isMaestroDesign,isDesktop:this.props.isDesktop}),this.props.isMaestroDesign?n.createElement(y,{},this._renderFileUploader(),this._renderAppActionsMenu()):void 0)}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/recent_activity/react/recent_activity_item_container",["external/underscore","external/classnames","external/react","modules/core/exception","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_view_models","modules/dirty/recent_activity/actions/recent_activity_actions","modules/dirty/recent_activity/react/recent_activity_item_view","modules/dirty/recent_activity/react/recent_activity_item_desktop_view","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/stores/selection_store"],function(t,n,i,r,o,s,a,c,l,u,h,d){var p,_,m,assert,f;return assert=r.assert,_=u.RECENT_EVENT_TYPES,f=i.DOM,p=s.PropTypes,m=i.createClass({displayName:"RecentActivityItemContainer",propTypes:{recentItem:p.recentItem.isRequired,isDesktop:i.PropTypes.bool.isRequired,isMaestroDesign:i.PropTypes.bool},getDefaultProps:function(){return{isMaestroDesign:!1}},getInitialState:function(){return{attachments:[],selectedAttachmentIds:[],isCollapsed:!0}},componentWillMount:function(){var e;return e=[],e.push(d.addListener(this._onSelectionStoreChange)),e.push(h.addListener(this._onAttachmentStoreChange)),this._removeStoreListeners=function(){var t,n;for(n=[];t=e.pop();)n.push(t());return n},this.setState({attachments:this._attachmentsFromStore(),selectedAttachmentIds:d.getByRecentItemId(this.props.recentItem.id)})},componentWillUnmount:function(){return this._removeStoreListeners()},_onSelectionStoreChange:function(){return this.setState({selectedAttachmentIds:d.getByRecentItemId(this.props.recentItem.id)})},_onAttachmentStoreChange:function(){return this.setState({attachments:this._attachmentsFromStore()})},_handleHeaderClick:function(){return this.setState({isCollapsed:!this.state.isCollapsed})},_attachmentsFromStore:function(){return h.getByIds(this.props.recentItem.attachmentIds)},_performAction:function(e){var n;return n=this.state.attachments,this.state.selectedAttachmentIds.length&&(n=this.state.selectedAttachmentIds.map(function(e){return function(n){return t.findWhere(e.state.attachments,{id:n})}}(this))),e.call(this,n)},_clearSelection:function(){return a.deselectAttachments(this.props.recentItem.id,this.state.selectedAttachmentIds)},_handleShare:function(){var e,n;return n=this.props.recentItem.viewingUserId,e=this.props.recentItem.attachmentIds.length,this._performAction(function(i){var r,o;return 1===e||1===i.length?(r=i[0],a.shareFile(n,r.id,{totalCount:this.props.recentItem.attachmentIds.length,cellView:this})):(o=t.pluck(i,"id"),a.shareCollection(n,o,{totalCount:this.props.recentItem.attachmentIds.length,cellView:this}))})},_handleOpen:function(){return this._performAction(function(e){var t,n;return assert(1===e.length,"_handleOpen only supports a single attachment"),t=e[0],n=this.props.recentItem.viewingUserId,a.openFile(n,t.id,{totalCount:this.props.recentItem.attachmentIds.length,cellView:this})})},_handlePathClick:function(){var e,n;return e=t.pluck(this.state.attachments,"fqPath"),n=this.props.recentItem.attachmentIds.length,o.logOpenPathUrl(this.props.recentItem.viewingUserId,e,n,this)},_handleDelete:function(){return this._performAction(function(e){return a.promptAndDeleteAttachments(this.props.recentItem.viewingUserId,t.pluck(e,"id"),{totalCount:this.props.recentItem.attachmentIds.length,cellView:this}),this._clearSelection()})},_handleSelectAll:function(){var e;return e=t.pluck(this.state.attachments,"id"),a.selectAttachments(this.props.recentItem.id,e)},_handleDeselectAll:function(){return a.deselectAttachments(this.props.recentItem.id,this.state.selectedAttachmentIds)},_handlePreview:function(){return this._previewOrOpenFiles({shouldFocusCommentInput:!1})},_handleToggleSelect:function(e,t){return t?a.selectAttachments(this.props.recentItem.id,[e.id]):a.deselectAttachments(this.props.recentItem.id,[e.id])},_handleDownload:function(){return this._performAction(function(e){var n,i;return assert(1===e.length,"_handleDownload only supports a single attachment"),i=this.props.recentItem.viewingUserId,n=this.props.recentItem.attachmentIds.length,a.downloadFiles(i,t.pluck(e,"id"),{totalCount:n,cellView:this})})},_handleComment:function(){return this._performAction(function(e){var t;return assert(1===e.length,"_handleComment only supports a single attachment"),t=Math.max(0,this.state.attachments.indexOf(e[0])),this._previewOrOpenFiles({index:t,shouldFocusCommentInput:!0})})},_handleVersions:function(){return this._performAction(function(e){var t,n;return assert(1===e.length,"_handleVersions only supports a single attachment"),n=this.props.recentItem.viewingUserId,t=this.props.recentItem.attachmentIds.length,a.openVersions(n,e[0].id,{totalCount:t,cellView:this})})},_isSharedLink:function(){var t,n;return n=[_.FILE_SHARED_ADD,_.FILE_SHARED_VIEW],t=this.props.recentItem.type,e.call(n,t)>=0},_previewOrOpenFiles:function(e){var n,i,r,o;return null==e&&(e={}),this._isSharedLink()?void this._performAction(function(e){return assert(1===e.length,"_previewOrOpenFiles only supports a single shared link"),a.browseFile(e[0].entityUri)}):(r=e.shouldFocusCommentInput===!0,o=this.props.recentItem.viewingUserId,n=t.pluck(this.state.attachments,"id"),i={totalCount:this.props.recentItem.attachmentIds.length,cellView:this},a.previewFiles(o,n,{index:e.index||0,shouldFocusCommentInput:r},i))},render:function(){return this.props.isDesktop?i.createElement(l,{recentItem:this.props.recentItem,attachments:this.state.attachments,isCollapsed:this.state.isCollapsed,handleHeaderClick:this._handleHeaderClick}):i.createElement(c,{recentItem:this.props.recentItem,attachments:this.state.attachments,handleShare:this._handleShare,handleOpen:this._handleOpen,handlePreview:this._handlePreview,handleDelete:this._handleDelete,handlePathClick:this._handlePathClick,handleDeselectAll:this._handleDeselectAll,handleSelectAll:this._handleSelectAll,handleToggleSelect:this._handleToggleSelect,handleDownload:this._handleDownload,handleComment:this._handleComment,handleVersions:this._handleVersions,handleHeaderClick:this._handleHeaderClick,isCollapsed:this.state.isCollapsed,selectedAttachmentIds:this.state.selectedAttachmentIds,isMaestroDesign:this.props.isMaestroDesign})}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/recent_activity/react/recent_activity_item_desktop_view",["external/classnames","external/underscore","external/react","modules/core/i18n","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/react/helpers","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/recent_activity_text_helper","modules/dirty/recent_activity/react/attachment_list_desktop_view","modules/clean/recent_activity/react/pending_attachment_list_view","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/dirty/recent_activity/react/doc_attachment_list_desktop_view","modules/clean/recent_activity/recent_activity_constants","modules/clean/server_side_client_view_bridge"],function(t,n,i,r,o,s,a,c,l,u,h,d,p,_,m,f){var g,v,y,w,I,E,T,b,C,S;return T=r._,S=r.ungettext,b=a.compareStateAndProps,w=c.RECENT_EVENT_FILTER_TYPE,g=c.MAX_INITIAL_THUMBNAIL_ATTACHMENTS,C=u.snippetList,I=m.RECENT_EVENT_TYPES,y=i.PropTypes,v=l.PropTypes,E=i.createClass({displayName:"RecentActivityItemDesktopView",propTypes:{recentItem:v.recentItem.isRequired,attachments:y.arrayOf(v.attachment),isCollapsed:y.bool,handleHeaderClick:y.func},getDefaultProps:function(){return{isCollapsed:!0,attachments:[],handleHeaderClick:function(){}}},shouldComponentUpdate:b,_shouldDisableActions:function(){return!this._hasLoadedAttachments()},_onDisabled:function(e){return e.preventDefault()},_ensureEnabled:function(e){return this._shouldDisableActions()?this._onDisabled:e},_onCopyLink:function(e){var t;return e.preventDefault(),e.stopPropagation(),t=this.props.attachments[0],f.CopyShmodelToClipboard(t.nsId,t.nsPath,"piano")},_handleContextMenu:function(e){var t;return e.preventDefault(),e.stopPropagation(),t=this.props.attachments[0],f.PianoShowFileContextMenu(t.nsId,t.nsPath)},_handleClick:function(e){var t;return e.preventDefault(),e.stopPropagation(),t=this.props.attachments[0],f.PianoOpenFileOrFolder(t.nsId,t.nsPath)},_heading:function(){var t,i,r,s,a,c;return this.props.attachments.length<2?s=o.em_snippet(this.props.recentItem.displayName,30):(t=this.props.recentItem.attachmentIds.length,r=n.uniq(n.values(this.props.recentItem.filterTypesByKey)),s=S("%(count)s File","%(count)s Files",t).format({count:t}),i=this.props.attachments.filter(n.property("isLoaded")).map(n.property("displayName")),i.length&&(s=C(i,30,{totalCount:this.props.recentItem.attachmentIds.length})),1===r.length?r[0]===w.PHOTOS?s=S("%(count)s Image","%(count)s Images",t).format({count:t}):r[0]===w.VIDEOS?s=S("%(count)s Video","%(count)s Videos",t).format({count:t}):r[0]===w.VISUAL_NOTES&&(s=S("%(count)s Visual note","%(count)s Visual notes",t).format({count:t})):2===r.length&&(a=w.PHOTOS,e.call(r,a)>=0&&(c=w.VIDEOS,e.call(r,c)>=0)&&(s=T("%(count)s Images and Videos").format({count:t})))),s},_subheading:function(){return this._isSharedLink()?null:i.createElement(s,{paths:this.props.recentItem.paths,viewingUserId:this.props.recentItem.viewingUserId,useLinks:!1})},_isAggregation:function(){return this.props.recentItem.attachmentIds.length>1},_isSharedLink:function(){var t,n;return n=[I.FILE_SHARED_ADD,I.FILE_SHARED_VIEW],t=this.props.recentItem.type,e.call(n,t)>=0},_shouldShowThumbnails:function(){return this._isSharedLink()?!1:l.shouldShowThumbnails(this.props.recentItem.filterTypesByKey)},_canRenderAttachmentView:function(){var e,t;return t=this.props.attachments.filter(function(e){return e.isLoaded}),e=t.length===this.props.recentItem.attachmentIds.length,e||t.length>=g},_hasLoadedAttachments:function(){return this.props.attachments.length>0&&n.any(this.props.attachments,n.property("isLoaded"))},_showCopyLink:function(){return!this._isSharedLink()&&!this._isAggregation()},_icon:function(){var e,t,i;return t=this.props.recentItem.icon+"_32",this.props.recentItem.attachmentIds.length>1&&(e=n.find(this.props.attachments,function(e){return e.previewInfo}),(null!=e&&null!=(i=e.previewInfo)?i.icon:void 0)&&(t=e.previewInfo.icon),t=t.replace(/_32$/,"_stack_32")),t},_thumbnailUrl:function(){var e;return e=null,1===this.props.attachments.length&&this.props.attachments[0].thumbnailUrl&&(e=this.props.attachments[0].thumbnailUrl),e},_renderCopyLinkButton:function(){var e;return e={disabled:this._shouldDisableActions(),"button-secondary":!0,"recents-item__share-link":!0},i.createElement("a",{ref:"copyLink",className:t(e),href:"#share",onClick:this._ensureEnabled(this._onCopyLink)},T("Copy link"))},_renderAttachments:function(){var e;return e=null,this._shouldShowThumbnails()?e=this._canRenderAttachmentView()?i.createElement(h,{ref:"attachments",attachments:this.props.attachments,duplicateIds:this.props.recentItem.duplicateIds}):i.createElement(d,{ref:"pendingAttachments",count:this.props.recentItem.attachmentIds.length}):this._isAggregation()?e=i.createElement(_,{ref:"docAttachments",recentItem:this.props.recentItem,attachments:this.props.attachments,isCollapsed:this.props.isCollapsed}):void 0},render:function(){var e,n,r,o,s,a,c,l;return e=this._renderAttachments(),o=this._icon(),l=this._thumbnailUrl(),n=[],this._showCopyLink()&&(n=[i.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this._renderCopyLinkButton())]),r=i.createElement(p,{ref:"header",header:{heading:this._heading(),subheading:this._subheading(),icon:o,thumbnailUrl:l},handleClick:this._isAggregation()?this.props.handleHeaderClick:void 0,handleHeadingContextMenu:this._isAggregation()?void 0:this._handleContextMenu,tooltipShown:!1,recentActivityType:this.props.recentItem.type},n),c={"recents-item":!0,"recents-item--loaded":this._hasLoadedAttachments()},s=this._isAggregation()?null:this._handleClick,a=this._isAggregation()?null:this._handleContextMenu,i.createElement("li",{"data-item-id":this.props.recentItem.id,Used:!0,for:!0,Selenium:!0,test:!0,"data-item-type":this.props.recentItem.type,Used:!0,for:!0,logging:!0,of:!0,target_activity_type:!0,"data-item-date":this.props.recentItem.when,Used:!0,for:!0,logging:!0,of:!0,days_ago:!0,className:t(c),onClick:s,onContextMenu:a},r,e)}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},t=[].slice;define("modules/dirty/recent_activity/react/recent_activity_item_view",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/react/helpers","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/recent_activity_view_helper","modules/clean/recent_activity/recent_activity_text_helper","modules/dirty/recent_activity/react/attachment_list_view","modules/dirty/recent_activity/react/comment_attachment_view","modules/clean/recent_activity/react/pending_attachment_list_view","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/recent_activity/react/recent_activity_item_actions_view","modules/dirty/recent_activity/react/doc_attachment_list_view","modules/clean/recent_activity/recent_activity_constants"],function(n,i,r,o,s,a,c,l,u,h,d,p,_,m,f,g,v,y){var w,I,E,T,b,C,S,R,A,k,D,P;return S=o._,P=o.ungettext,R=c.compareStateAndProps,T=l.RECENT_EVENT_FILTER_TYPE,w=l.MAX_INITIAL_THUMBNAIL_ATTACHMENTS,k=h.ensureUserIntentToClick,D=d.snippetList,b=y.RECENT_EVENT_TYPES,A=r.DOM,E=r.PropTypes,I=u.PropTypes,C=r.createClass({displayName:"RecentActivityItemView",propTypes:{recentItem:I.recentItem.isRequired,attachments:E.arrayOf(I.attachment),handleShare:E.func,handleOpen:E.func,handlePreview:E.func,handleDelete:E.func,handlePathClick:E.func,handleDeselectAll:E.func,handleSelectAll:E.func,handleToggleSelect:E.func,handleDownload:r.PropTypes.func,handleVersions:r.PropTypes.func,handleComment:r.PropTypes.func,handleHeaderClick:E.func,isCollapsed:E.bool,selectedAttachmentIds:E.array,isMaestroDesign:r.PropTypes.bool},getDefaultProps:function(){return{handleShare:function(){},handleOpen:function(){},handlePreview:function(){},handleDelete:function(){},handlePathClick:function(){},handleDeselectAll:function(){},handleSelectAll:function(){},handleToggleSelect:function(){},handleDownload:function(){},handleVersions:function(){},handleComment:function(){},handleHeaderClick:function(){},isCollapsed:!0,attachments:[],selectedAttachmentIds:[],isMaestroDesign:!1}},getInitialState:function(){return{tooltipShown:!1}},shouldComponentUpdate:R,_shouldDisableActions:function(){return!this._hasLoadedAttachments()},_onDisabled:function(e){return e.preventDefault()},_ensureEnabled:function(e){return this._shouldDisableActions()?this._onDisabled:e},_handleBlur:function(e){return this.setState({isFocused:!1})},_handleFocus:function(e){return this.setState({isFocused:!0})},_onShare:function(e){return e.preventDefault(),this.props.handleShare()},_onSelectAll:function(e){return e.preventDefault(),this.props.handleSelectAll()},_onShowTooltip:function(){return this.setState({tooltipShown:!0})},_onHideTooltip:function(){return this.setState({tooltipShown:!1})},_heading:function(){var t,i,r,o,a,c;return this.props.attachments.length<2?o=s.em_snippet(this.props.recentItem.displayName,30):(t=this.props.recentItem.attachmentIds.length,r=n.uniq(n.values(this.props.recentItem.filterTypesByKey)),o=P("%(count)s File","%(count)s Files",t).format({count:t}),i=this.props.attachments.filter(n.property("isLoaded")).map(n.property("displayName")),i.length&&(o=D(i,30,{totalCount:this.props.recentItem.attachmentIds.length})),1===r.length?r[0]===T.PHOTOS?o=P("%(count)s Image","%(count)s Images",t).format({count:t}):r[0]===T.VIDEOS?o=P("%(count)s Video","%(count)s Videos",t).format({count:t}):r[0]===T.VISUAL_NOTES&&(o=P("%(count)s Visual note","%(count)s Visual notes",t).format({count:t})):2===r.length&&(a=T.PHOTOS,e.call(r,a)>=0&&(c=T.VIDEOS,e.call(r,c)>=0)&&(o=S("%(count)s Images and Videos").format({count:t})))),o},_subheading:function(){return this._isSharedLink()?this.props.recentItem.type===b.FILE_SHARED_ADD?A.a({className:"recents-item__subheading-path",href:"/links/your_links"},S("Your links")):S("Recently visited"):r.createElement(a,{handlePathClick:this.props.handlePathClick,paths:this.props.recentItem.paths,viewingUserId:this.props.recentItem.viewingUserId})},_isAggregation:function(){return this.props.recentItem.attachmentIds.length>1},_isSharedLink:function(){var t,n;return n=[b.FILE_SHARED_ADD,b.FILE_SHARED_VIEW],t=this.props.recentItem.type,e.call(n,t)>=0},_shouldShowComment:function(){var e;return null!=(null!=(e=this.props.attachments[0])?e.commentRawText:void 0)},_shouldShowThumbnails:function(){return this._isSharedLink()?!1:u.shouldShowThumbnails(this.props.recentItem.filterTypesByKey)},_canRenderAttachmentView:function(){var e,t;return t=this.props.attachments.filter(function(e){return e.isLoaded}),e=t.length===this.props.recentItem.attachmentIds.length,e||t.length>=w},_hasLoadedAttachments:function(){return this.props.attachments.length>0&&n.any(this.props.attachments,n.property("isLoaded"))},_selectedItemsInRootCollection:function(){return n.all(this.props.selectedAttachmentIds,function(e){return function(t){var i;return i=n.findWhere(e.props.attachments,{id:t}),i.inRootCollection}}(this))},_selectedItemsNotReadOnly:function(){return n.all(this.props.selectedAttachmentIds,function(e){return function(t){var i;return i=n.findWhere(e.props.attachments,{id:t}),!i.isReadOnly}}(this))},_allItemsInRootCollection:function(){return n.all(this.props.attachments,function(e){return e.inRootCollection})},_allItemsNotReadOnly:function(){return n.all(this.props.attachments,function(e){return!e.isReadOnly})},_actionPermissions:function(){var e,t,n,i,r,o,s,a,c,l;return s=this.props.selectedAttachmentIds.length,a=this._selectedItemsInRootCollection(),c=this._selectedItemsNotReadOnly(),t=this._allItemsInRootCollection(),n=this._allItemsNotReadOnly(),i=this._isAggregation(),r=s>0,o=!i||1===s,l=this.props.attachments[0],e=r&&c||i&&n||!i&&l&&!l.isReadOnly,this._isSharedLink()?{open:o&&(null!=l?l.canOpen:void 0)}:{share:o||r&&a||t,open:o&&(null!=l?l.canOpen:void 0),delete:e,download:o,comment:o&&!(null!=l?l.isDir:void 0),versions:o&&!(null!=l?l.isDir:void 0)}},_icon:function(){var e,t,i;return t=this.props.recentItem.icon+"_32",this.props.recentItem.attachmentIds.length>1&&(e=n.find(this.props.attachments,function(e){return e.previewInfo}),(null!=e&&null!=(i=e.previewInfo)?i.icon:void 0)&&(t=e.previewInfo.icon),t=t.replace(/_32$/,"_stack_32")),t},_thumbnailUrl:function(){var e;return e=null,1===this.props.attachments.length&&this.props.attachments[0].thumbnailUrl&&(e=this.props.attachments[0].thumbnailUrl),e},_renderActions:function(){var e,t;return t=this._actionPermissions(),e=function(e,n){return t[e]?n:null},r.createElement(g,{ref:"recentsItemActionsView",handleOpen:e("open",this.props.handleOpen),handleDelete:e("delete",this.props.handleDelete),handleDownload:e("download",this.props.handleDownload),handleVersions:e("versions",this.props.handleVersions),handleComment:e("comment",this.props.handleComment),handleDeselectAll:this.props.handleDeselectAll,handleSelectAll:this.props.handleSelectAll,onShowTooltip:this._onShowTooltip,onHideTooltip:this._onHideTooltip,selectCount:this.props.selectedAttachmentIds.length,attachmentCount:this.props.recentItem.attachmentIds.length,disableActions:!this._hasLoadedAttachments(),isMaestroDesign:this.props.isMaestroDesign})},_renderShareButton:function(){var e;return this.props.handleShare?(e={disabled:this._shouldDisableActions(),"button-secondary":!0,"recents-item__share-link":!0},A.a({ref:"shareLink",className:i(e),href:"#share",onClick:this._ensureEnabled(this._onShare)},S("Share"))):null},_renderSelectAllButton:function(){var e;return e={disabled:this._shouldDisableActions(),"button-secondary":!0,"recents-action-button":!0},A.a({className:i(e),href:"#select-all",onClick:this._ensureEnabled(this._onSelectAll),ref:"selectAllButton"},S("Select all"))},_renderAttachments:function(){var e;return e=null,this._shouldShowThumbnails()?e=this._canRenderAttachmentView()?r.createElement(p,{ref:"attachments",attachments:this.props.attachments,duplicateIds:this.props.recentItem.duplicateIds,handleToggleSelect:this.props.handleToggleSelect,selectedAttachmentIds:this.props.selectedAttachmentIds}):r.createElement(m,{ref:"pendingAttachments",count:this.props.recentItem.attachmentIds.length}):this._isAggregation()?e=r.createElement(v,{ref:"docAttachments",recentItem:this.props.recentItem,attachments:this.props.attachments,isCollapsed:this.props.isCollapsed,isMaestroDesign:this.props.isMaestroDesign}):this._shouldShowComment()?e=r.createElement(_,{ref:"commentAttachment",attachment:this.props.attachments[0],handlePreview:this.props.handlePreview}):void 0},render:function(){var e,n,o,s,a,c,l,u,h,d;return e=this._renderAttachments(),a=this._icon(),d=this._thumbnailUrl(),c=this._actionPermissions(),h=this._shouldShowThumbnails()&&this.props.recentItem.attachmentIds.length>1&&0===this.props.selectedAttachmentIds.length,o=[],h?o=[A.div({className:"recents-item__select-all recents-item__action-button"},this._renderSelectAllButton())]:c.share&&(o=[A.div({className:"recents-item__sharing recents-item__action-button"},this._renderShareButton())]),o.push(this._renderActions()),s=r.createElement.apply(r,[f,{ref:"header",header:{heading:this._heading(),subheading:this._subheading(),icon:a,thumbnailUrl:d},handleClick:this._isAggregation()?this.props.handleHeaderClick:this.props.handlePreview,tooltipShown:this.state.tooltipShown,recentActivityType:this.props.recentItem.type}].concat(t.call(o))),l={"recents-item":!0,"recents-item--focused-in":this.state.isFocused,"recents-item--loaded":this._hasLoadedAttachments()},u=this._shouldShowThumbnails()||!this._isAggregation(),n=u?k(this.props.handlePreview):null,A.li({"data-item-id":this.props.recentItem.id,"data-item-type":this.props.recentItem.type,"data-item-date":this.props.recentItem.when,className:i(l),onClick:n,onBlur:this._handleBlur,onFocus:this._handleFocus},s,e)}})})}.call(this),function(){define("modules/dirty/recent_activity/react/recent_activity_list_view",["external/classnames","external/react","modules/dirty/recent_activity/react/recent_activity_item_container"],function(e,t,n){var i,r;return r=t.DOM,i=t.createClass({displayName:"RecentActivityListView",propTypes:function(){return{items:t.PropTypes.array.isRequired,isPending:t.PropTypes.bool,isDesktop:t.PropTypes.bool.isRequired,isMaestroDesign:t.PropTypes.bool}},getDefaultProps:function(){return{isPending:!1,isMaestroDesign:!1}},render:function(){var i,o,s;return i=function(){var e,i,r,o;for(r=this.props.items,o=[],e=0,i=r.length;i>e;e++)s=r[e],o.push(t.createElement(n,{key:s.id,recentItem:s,isDesktop:this.props.isDesktop,isMaestroDesign:this.props.isMaestroDesign}));return o}.call(this),o={"recents-list":!0,"recents-list--is-pending":this.props.isPending&&0===i.length},r.ul({className:e(o)},i)}})})}.call(this),function(){define("modules/dirty/recent_activity/react/recent_activity_sections_view",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/dirty/recent_activity/react/recent_activity_list_view","modules/clean/react/sticky/container","modules/clean/react/sticky/sticky"],function(e,t,n,i,r,o,s){var a,c,l,u,h,d;return u=i._,l=o.StickyContainer,c=s.Sticky,h=n.createElement,d=n.DOM,a=n.createClass({displayName:"RecentActivitySectionView",propTypes:{items:n.PropTypes.array.isRequired,isPending:n.PropTypes.bool,isDesktop:n.PropTypes.bool.isRequired,localDatetime:n.PropTypes.string,isMaestroDesign:n.PropTypes.bool},getDefaultProps:function(){return{isPending:!1,localDatetime:Date.now(),isMaestroDesign:!1}},_getTimeBands:function(){var e,t,n,i,r,o,s,a,c,l,u;return t=this.props.localDatetime,n=864e5,u=new Date(t),u.setHours(0,0,0,0),c=u.getTime(),l=c-n,e=new Date(t),0===u.getDay()?e.setDate(u.getDate()-7):e.setDate(u.getDate()-u.getDay()-1),e.setHours(0),a=e.getTime(),o=a-7*n,u.setDate(1),s=u.getTime(),u.setMonth(u.getMonth()-1),i=u.getTime(),u.setMonth(u.getMonth()-3),r=u.getTime(),{today:c,yesterday:l,thisWeek:a,lastWeek:o,thisMonth:s,lastMonth:i,lastThreeMonths:r}},_getSections:function(){var t,n;return t=this._getTimeBands(),n=e.groupBy(this.props.items,function(e){return e.when>=t.today?"today":e.when>=t.yesterday?"yesterday":e.when>=t.thisWeek?"thisWeek":e.when>=t.lastWeek?"lastWeek":e.when>=t.thisMonth?"thisMonth":e.when>=t.lastMonth?"lastMonth":e.when>=t.lastThreeMonths?"lastThreeMonths":"beforeLastThreeMonths"})},render:function(){var e,t,n,i,o,s,a,p,_;_=this._getSections(),e=[],o=96,i=40,t={today:u("Today"),yesterday:u("Yesterday"),thisWeek:u("This week"),lastWeek:u("Last week"),thisMonth:u("This month"),lastMonth:u("Last month"),lastThreeMonths:u("Three months ago"),beforeLastThreeMonths:u("Older")};for(s in _)n=_[s],p=d.h2({className:"recents-section__title"},t[s]),a=h(r,{items:n,isPending:this.props.isPending,isDesktop:this.props.isDesktop,isMaestroDesign:this.props.isMaestroDesign}),this.props.isMaestroDesign?e.push(d.li({className:"recents-section",key:s},h(l,{offsetTop:o},h(c,{offsetHeight:i},p),a))):e.push(d.li({className:"recents-section",key:s},p,a));return d.ul({className:"recents-view__sections"},e)}})})}.call(this),function(){var e=[].slice;define("modules/dirty/recent_activity/react/recent_activity_view",["external/underscore","external/classnames","external/react","modules/clean/components/loading_indicator","modules/clean/gandalf_util","modules/clean/recent_activity/react/recent_activity_onboarding_view","modules/clean/recent_activity/react/recent_activity_blank_slate_view","modules/clean/recent_activity/recent_activity_constants","modules/dirty/recent_activity/react/recent_activity_sections_view"],function(t,n,i,r,o,s,a,c,l){var u,h,d,p,_;return d=c.RECENT_EVENT_FILTER_TYPE,h=c.RECENT_CREATE_FILTER,_=i.DOM,u=i.PropTypes,p=i.createClass({displayName:"RecentActivityView",propTypes:function(){return{items:u.array.isRequired,filter:u.oneOf(t.values(d)),isPending:u.boolean,seenOnboarding:u.boolean,onOnboardingConfirm:u.func,showNewFeatureMessage:i.PropTypes.bool,userId:u.number.isRequired,isDesktop:u.bool.isRequired,isMaestroDesign:i.PropTypes.bool,localDatetime:i.PropTypes.string}},getDefaultProps:function(){return{filter:d.ALL,isPending:!1,seenOnboarding:!1,onOnboardingConfirm:function(){},isMaestroDesign:!1}},_onOnboardingConfirm:function(){return this.props.onOnboardingConfirm()},_renderLoadingView:function(){var e;return e=i.createElement(r,{style:r.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}),_.div({className:"recents-loading-view"},e)},_renderOnboardingView:function(){var e,t,n;return e=0===this.props.items.length,t=this.props.filter===d.ALL,n=t&&e&&!this.props.isPending,this.props.isMaestroDesign||this.props.seenOnboarding||n?void 0:i.createElement(s,{onConfirm:this._onOnboardingConfirm,showNewFeatureMessage:this.props.showNewFeatureMessage,userId:this.props.userId})},_renderSectionView:function(){return i.createElement(l,this.props)},_renderPendingContent:function(){return[this._renderOnboardingView(),this._renderLoadingView(),this._renderSectionView()]},_renderBlankSlateContent:function(){var e;return e=i.createElement(a,{ref:"blankslate",filter:this.props.filter}),[this._renderOnboardingView(),e]},_renderLoadedContent:function(){var e;return this.props.isPending&&(e=this._renderLoadingView()),[this._renderOnboardingView(),this._renderSectionView(),e]},render:function(){var t,i;return i=this.props.items.length?this._renderLoadedContent():this.props.isPending?this._renderPendingContent():this._renderBlankSlateContent(),t={"recents-view":!0,"recents-view--is-pending":this.props.isPending&&0===this.props.items.length},_.div.apply(_,[{className:n(t)}].concat(e.call(i)))}})})}.call(this),function(){var e=[].slice;define("modules/dirty/recent_activity/recents_global_actions",["jquery","external/underscore","external/classnames","external/react","modules/clean/page_role_observer","modules/clean/react/sprite","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/uploader","modules/clean/sharing/wizard/wizard_modals","modules/clean/viewer","modules/constants/viewer","modules/core/i18n","modules/clean/require_wrapper"],function(t,n,i,r,o,s,a,c,l,u,h,d,p){var _,m,f,g,v,y,w,I;return y=a.UploaderActions,_=c.FileUploader,f=h.ROLE_WORK,m=h.ROLE_PERSONAL,w=d._,v=p.RequireWrapper,I=r.DOM,g=r.createClass({displayName:"RecentsGlobalActions",propTypes:{role:r.PropTypes.oneOf([f,m]).isRequired},getInitialState:function(){return{role:this.props.role}},componentWillMount:function(){return y.setUser({user:this._currentUser()}),o.addListener(this._onRoleChange)},componentWillUnmount:function(){return o.removeListener(this._onRoleChange)},_renderIcon:function(e){return r.createElement(s,{ref:"icon",group:"web",name:e,alt:""})},_currentUser:function(){return u.get_viewer().get_user_by_role(this.state.role)},_onRoleChange:function(e){return e!==this.state.role?(this.setState({role:e}),y.setUser({user:this._currentUser()})):void 0},_showUploader:function(e){return e.preventDefault(),_.showModal()},_showShareDialog:function(e){return e.preventDefault(),l.showShareAFolderWizardModal(this._currentUser())},render:function(){var t,n,o,s;return t=["button-as-link","recents-global-actions__action"],o=I.button({ref:"uploadButton",onClick:this._showUploader,className:i.apply(null,["recents-global-actions__action--upload-link"].concat(e.call(t)))},this._renderIcon("upload_16"),w("Upload")),n=I.button({ref:"shareFolderButton",onClick:this._showShareDialog,className:i.apply(null,["recents-global-actions__action--share-folder"].concat(e.call(t)))},this._renderIcon("rainbow_16"),w("Share a folder")),s=r.createElement(_,{ref:"fileUploader"}),I.div({className:"recents-global-actions"},s,o,n)}}),{RecentsGlobalActions:g}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/search/search_bar",["jquery","external/underscore","external/modernizr","modules/core/exception","modules/core/i18n","modules/core/browser","modules/core/notify","modules/clean/ajax","modules/clean/analytics","modules/clean/browse_events","modules/clean/filepath","modules/clean/gandalf_util","modules/clean/keycode","modules/clean/page_role_observer","modules/clean/search/search_helpers","modules/clean/search/search_type","modules/clean/viewer","modules/constants/python","modules/constants/viewer","modules/clean/require_wrapper"],function(t,n,i,r,o,s,a,c,l,u,h,d,p,_,m,f,g,v,y,w){var I,E,T,b,C,S,assert;return assert=r.assert,S=o._,C=l.SearchClientActivityLogger,I=y.ROLE_PERSONAL,
E=y.ROLE_WORK,T=w.RequireWrapper,b=function(){function r(n,i,o,s){this.user_id=i,this.origin=o,null==s&&(s={}),this._focusDropdownRow=e(this._focusDropdownRow,this),this._unfocusDropdownRow=e(this._unfocusDropdownRow,this),this._getDropdownRow=e(this._getDropdownRow,this),this._hasDropdownRowAtIndex=e(this._hasDropdownRowAtIndex,this),this._getDropdownRowCount=e(this._getDropdownRowCount,this),this._isSearchBarVisible=e(this._isSearchBarVisible,this),this._fileForKey=e(this._fileForKey,this),this._keyForDropdownIndex=e(this._keyForDropdownIndex,this),this._runSearch=e(this._runSearch,this),this._openSuggestionByFileKey=e(this._openSuggestionByFileKey,this),this._suggestionClicked=e(this._suggestionClicked,this),this._buildSuggestion=e(this._buildSuggestion,this),this._getDropdownRowFocuser=e(this._getDropdownRowFocuser,this),this._displaySuggestions=e(this._displaySuggestions,this),this._hideSuggestions=e(this._hideSuggestions,this),this._showSuggestions=e(this._showSuggestions,this),this._gatherSuggestions=e(this._gatherSuggestions,this),this._searchInputUpdate=e(this._searchInputUpdate,this),this._trackKeyDownInSearchBar=e(this._trackKeyDownInSearchBar,this),this._searchBarUnFocused=e(this._searchBarUnFocused,this),this._searchBarFocused=e(this._searchBarFocused,this),this.blur=e(this.blur,this),this.focus=e(this.focus,this),this._on_role_change=e(this._on_role_change,this),this._on_browse_update=e(this._on_browse_update,this),this._on_window_blur=e(this._on_window_blur,this),this._on_window_focus=e(this._on_window_focus,this),this._debug_log=e(this._debug_log,this),this.$search_bar_holder=t(n),this.$search_bar=this.$search_bar_holder.find("#browse-search-input input"),this.$search_button=this.$search_bar_holder.find("#search-button"),this.$suggestion_list_holder=this.$search_bar_holder.find("#browse-search-suggested-list"),this.$suggestion_list=this.$suggestion_list_holder.find(".search-results"),this.$search_text=this.$suggestion_list_holder.find(".search-text"),this.$search_loading=this.$suggestion_list_holder.find("#search-loading"),this._prev_search_val="",this._prev_search_scope="",this._focused_dropdown_row=-1,this._window_blurred=!1,this._fq_path="",this._debug=!1,this._is_transitioning=!1,t(window).on("blur",this._on_window_blur),t(window).on("focus",this._on_window_focus),t(document).on(u.UPDATE,this._on_browse_update),_.addListener(this._on_role_change),this.$search_bar_holder.on("submit",function(e){return e.preventDefault()}),this.$search_bar.on("focus",function(e){return function(t){return e._debug_log("input-focus"),setTimeout(function(){return e._searchBarFocused()},0)}}(this)),this.$search_bar.on("blur",function(e){return function(t){return e._debug_log("input-blur"),setTimeout(function(){return e._searchBarUnFocused()},0)}}(this)),this.$search_bar.on("keydown",this._trackKeyDownInSearchBar),this.$search_button.on("click",this._runSearch),this.$search_text.on("mousedown",this._runSearch),this.$search_text.on("mousemove",this._getDropdownRowFocuser(0)),this._hideSuggestions(),this.$search_loading.hide(),s.listen_for_search_events===!0&&t(document).on(r.FOCUS_SEARCH_EVENT,this.focus)}return r.FOCUS_SEARCH_EVENT="db:searchbar:focus",r.SUBMIT_SEARCH_EVENT="db:searchbar:submit",r.PREVIEW_SEARCH_EVENT="db:searchbar:preview",r.prototype._files={},r.prototype.teardown=function(){return t(document).off(r.FOCUS_SEARCH_EVENT,this.focus),t(document).off(u.UPDATE,this._on_browse_update),t(window).off("blur",this._on_window_blur),t(window).off("focus",this._on_window_focus),_.removeListener(this._on_role_change)},r.prototype._debug_log=function(e){return this._debug?console.log("SearchBar: "+e):void 0},r.prototype._on_window_focus=function(){return this._window_blurred=!1},r.prototype._on_window_blur=function(){return this._window_blurred=!0},r.prototype._on_browse_update=function(e,t){return this._fq_path=(null!=t?t.containing_fq_path:void 0)||""},r.prototype._on_role_change=function(e){var t;return this.$search_bar.val(""),this._searchInputUpdate(),t=g.get_viewer(),this.user_id=t.get_user_by_role(e).id},r.prototype.focus=function(){return this.$search_bar.trigger("focus"),this._searchBarFocused(!0)},r.prototype.blur=function(){return this.$search_bar.trigger("blur"),this._searchBarUnFocused(!0)},r.prototype.previewFile=function(e,n){var i,o,c,l;return null==n&&(n=!1),l=g.get_viewer().get_user_by_id(this.user_id),o=this.origin,e.is_dir||n?(i=t.Event(r.PREVIEW_SEARCH_EVENT),this.$search_bar.trigger(i,[{file:e,force_new_window:n}]),i.isDefaultPrevented()?void 0:n===!0?s.open_tab(e.href):e.is_dir?s.redirect(e.href):void 0):(c={file_nsid:e.ns_id,file_sjid:e.sjid,firefly:!1,match_type:e.match_type,position:e.sort_rank,request_id:e.request_id,viewport:"dropdown-view",action_type:"file_view"},C.log("result_action",l.id,c),void T.require(["modules/clean/react/file_viewer/controller"],function(t){return t.open([e],0,l,"react-file-viewer",{disableRouting:!0,oref:v.OREF_CONSTANTS.BROWSE_SEARCHBOX,fileViewTarget:v.FileViewTargetType.PRIVATE,fileViewOrigin:o,fileViewAction:v.FileViewActionType.SEARCH})},function(){return a.error(a.DEFAULT_ERROR)}))},r.prototype._scopedSearch=function(){return""!==this._fq_path},r.prototype._searchBarFocused=function(e){return null==e&&(e=!1),this._debug_log("unfocus, winblur="+this._window_blurred.toString()),!e&&this._window_blurred||this.$search_bar.hasClass("focused")?void 0:(this.$search_bar_holder.addClass("focused"),this.$search_bar.addClass("focused"),this._is_transitioning=!0,this._callAfterTransition(function(e){return function(){return e._is_transitioning=!1}}(this)),this._searchInputUpdate())},r.prototype._searchBarUnFocused=function(e){return null==e&&(e=!1),this._debug_log("unfocus, winblur="+this._window_blurred.toString()),!e&&this._window_blurred||!this.$search_bar.hasClass("focused")?void 0:(this.$search_bar.removeClass("focused"),this.$search_bar_holder.removeClass("focused"),this._hideSuggestions())},r.prototype._trackKeyDownInSearchBar=function(e){switch(e.keyCode){case p.ESC:return this._onEscKey(e);case p.ENTER:return this._onEnterKey(e);case p.UP:return this._onUpKey(e);case p.DOWN:return this._onDownKey(e);case p.LEFT:case p.RIGHT:break;default:return clearTimeout(this.search_key_up_timer),this.search_key_up_timer=setTimeout(function(e){return function(){return e._searchInputUpdate(!0)}}(this),100)}},r.prototype._onEscKey=function(){return this.blur()},r.prototype._onEnterKey=function(){return 0===this._focused_dropdown_row||-1===this._focused_dropdown_row?this._runSearch():this._openSuggestionByFileKey(this._keyForDropdownIndex(this._focused_dropdown_row),!1)},r.prototype._onUpKey=function(e){return this._isSearchBarVisible()?(this._focusDropdownRow(Math.max(0,this._focused_dropdown_row-1)),e.preventDefault()):void 0},r.prototype._onDownKey=function(e){return this._isSearchBarVisible()?(this._focusDropdownRow(Math.min(this._getDropdownRowCount()-1,this._focused_dropdown_row+1)),e.preventDefault()):this._searchInputUpdate()},r.prototype._searchInputUpdate=function(){var e,t,i,r,o,s;return o=this.$search_bar.val(),""===o?(this.$search_text.html(""),this.$search_bar_holder.removeClass("active"),this._hideSuggestions(),this.$search_text.html(""),this.$suggestion_list.html(""),this._prev_search_val="",this._prev_search_scope=""):(this.$search_bar_holder.addClass("active"),this._showSuggestions(),s=g.get_viewer().get_user_by_id(this.user_id),i=g.get_root_name(s),e=S("Search for ‘%(res)s’ in %(root)s").format({res:'<span class="search-val-text">'+n.escape(o)+"</span>",root:n.escape(i)}),this._scopedSearch()&&(t=h.filename(this._fq_path),e=S("Search for ‘%(res)s’ in %(path)s").format({res:'<span class="search-val-text">'+n.escape(o)+"</span>",path:"<span>"+n.escape(t)+"</span>"})),r='<span class="dropdown-top-text">'+e+"</span>",this.$search_text.html(r),this._gatherSuggestions())},r.prototype._gatherSuggestions=function(){var e,t,n,i;if(n=this.$search_bar.val(),this._prev_search_val===n){if(this._scopedSearch()&&this._prev_search_scope===this._fq_path)return;if(""===this._prev_search_scope)return}return this.$suggestion_list.html(""),e={query:n,filename_only:!0,max_results:8,show_unmounted_results:!1},this._scopedSearch()?(e.fq_path=this._fq_path,this._prev_search_scope=this._fq_path):this._prev_search_scope="",this._prev_search_val=n,this.$search_loading.show(),t={firefly:!0,path_scoped:!1,search_type:f.COMPLETION,query_string:n},C.log("query_started",this.user_id,t),i=(new Date).getTime(),c.WebRequest({url:"/ajax_fulltext_search",data:e,subject_user:this.user_id,success:function(e){return function(r,o,s){var a,c,l,u,h,d,p;for(e.$search_loading.hide(),h=s.getResponseHeader("x-dropbox-request-id"),r=JSON.parse(r),p=!1,a=r.search_results.length>0?r.search_results[0]:null,u=r.search_results,c=0,l=u.length;l>c;c++)d=u[c],"True"===d.used_spellcorrect&&(p=!0);return t=C.create_completion_log_dict(t,p,h,i,n,n===e.$search_bar.val(),r.search_results.length,null,a),C.log("query_completed",e.user_id,t),n===e.$search_bar.val()?e._displaySuggestions(r,h):void 0}}(this),error:function(e){return function(n,r,o){var s;return e.$search_loading.hide(),s=n.getResponseHeader("x-dropbox-request-id"),t=C.create_completion_log_dict(t,null,s,i,null,null,null,r),C.log("query_failed",e.user_id,t)}}(this)})},r.prototype._showSuggestions=function(){return this._callAfterTransition(function(e){return function(){return e.$search_bar.hasClass("focused")?(e.$suggestion_list_holder.show(),e._focusDropdownRow(0)):void 0}}(this))},r.prototype._hideSuggestions=function(){return this.$suggestion_list_holder.hide()},r.prototype._displaySuggestions=function(e,t){var n,i,r,o,s,a,c,l;for(null==t&&(t=null),i=e.search_results,this._files={},c=[],a=i.slice(0,8),o=r=0,s=a.length;s>r;o=++r)n=a[o],l=this._buildSuggestion(n),l.on("mousemove",this._getDropdownRowFocuser(o+1)),c.push(l),this._files[this._keyForFile(n)]=this._createBrowseFileShim(n,t);return this.$suggestion_list.html(c),this.$suggestion_list_holder.addClass("ie8hax").removeClass("ie8hax")},r.prototype._getDropdownRowFocuser=function(e){return function(t){return function(){return t._focusDropdownRow(e)}}(this)},r.prototype._buildSuggestion=function(e){var n,i,r,o,s,a,c;return c=e.fq_path.split("/"),s=c.slice(-1)[0],i=m.highlightMatch(s,e.filename_highlights).addClass("file-name"),a=2===c.length?"/":c.slice(0,-1).join("/"),r=t("<span class='file-path'><span class='file-path-in' /><span class='file-location' /></span>"),r.find(".file-path-in").text(S("in ")),r.find(".file-location").text(a),n=t("<img class='sprite sprite_web icon s_web_"+e.icon+"' src='/static/images/icons/icon_spacer-vflN3BYt2.gif' alt='' />"),o=t('<div class="search-item clearfix"/>').append(r.prepend(n,i)),o.attr("data-identity",this._keyForFile(e)),o.data("suggestion-href",e.href),o.on("mousedown",this._suggestionClicked),o},r.prototype._suggestionClicked=function(e){var t,n;return t=1,n=e.metaKey||e.button===t,this._openSuggestionByFileKey(this._keyForElement(e.target),n),this._searchBarUnFocused(!0)},r.prototype._openSuggestionByFileKey=function(e,t){var n;return n=this._fileForKey(e),this.previewFile(n,t),this._hideSuggestions()},r.prototype._runSearch=function(){var e,i,o;return clearTimeout(this.search_key_up_timer),e=t.Event(r.SUBMIT_SEARCH_EVENT),this.$search_bar.trigger(e),!e.isDefaultPrevented()&&t.trim(this.$search_bar.val())?(o=g.get_viewer().get_user_by_id(this.user_id),i=m.buildSearchURL(o,this.$search_bar.val(),this._fq_path),this.$search_bar_holder.removeClass("active").addClass("loading"),n.defer(function(){return s.redirect(i)}),this._hideSuggestions()):void 0},r.prototype._keyForFile=function(e){return e.ns_id+"_"+e.sjid},r.prototype._keyForDropdownIndex=function(e){return this._getDropdownRow(e).data("identity")},r.prototype._fileForKey=function(e){return this._files[e]},r.prototype._keyForElement=function(e){return t(e).closest("[data-identity]").attr("data-identity")},r.prototype._isSearchBarVisible=function(){return this.$suggestion_list_holder.is(":visible")},r.prototype._getDropdownRowCount=function(){return this._isSearchBarVisible()?this.$suggestion_list.children().size()+1:0},r.prototype._hasDropdownRowAtIndex=function(e){return e>=-1&&e<this._getDropdownRowCount()},r.prototype._getDropdownRow=function(e){return assert(this._hasDropdownRowAtIndex(e),"Focus on nonexistent search bar suggestion"),0===e?this.$search_text:this.$suggestion_list.children().eq(e-1)},r.prototype._unfocusDropdownRow=function(){return this._hasDropdownRowAtIndex(this._focused_dropdown_row)&&(this._getDropdownRow(this._focused_dropdown_row).removeClass("focused"),this.$search_bar_holder.addClass("ie8hax").removeClass("ie8hax")),this._focused_dropdown_row=-1},r.prototype._focusDropdownRow=function(e){return this._focused_dropdown_row!==e?(this._unfocusDropdownRow(),this._getDropdownRow(e).addClass("focused"),this.$search_bar_holder.addClass("ie8hax").removeClass("ie8hax"),this._focused_dropdown_row=e):void 0},r.prototype._createBrowseFileShim=function(e,t){var i;return null==t&&(t=null),n.extend({},e,{filename:h.filename(e.fq_path),size:"None"!==e.size?e.size:"",is_deleted:-1===e.bytes,dir:e.is_dir?1:0,sort_key:e.sort_key||[""],request_id:t,match_type:null!=(i=e.match_type)?i:"UNKNOWN_MATCH",last_modified_fname:null,caption:null})},r.prototype._callAfterTransition=function(e){var t,r;return r=this.$search_bar.css("transition-duration"),t=r&&"0s"!==r,i.csstransitions&&t&&this._is_transitioning?this.$search_bar.one("transitionend",e):n.defer(e)},r}()})}.call(this);
//# sourceMappingURL=pkg-ae.min.js-vflmSvLv0.map